"use strict";function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function compararObjetoER(a,b){return a.nombre<b.nombre?-1:a.nombre>b.nombre?1:0}var _get=function(_x2,_x3,_x4){for(var _again=!0;_again;){var object=_x2,property=_x3,receiver=_x4;desc=parent=getter=void 0,_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return void 0;_x2=parent,_x3=property,_x4=receiver,_again=!0}},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ESTADO_APLICACION={Normal:0,Anadiendo:1,Borrando:2,Editando:3},VALIDACION_NOMBRE=/^[A-Za-z\_ÁÉÍÓÚáéíóúñÑüÜ][A-Za-z\_ÁÉÍÓÚáéíóúñÑüÜ0-9]*$/i,ERROR={NombreCorto:1,NombreLargo:2,NombreNoCumple:4,AtributoNoCumple:8,NoHayEntidad:16,NombreRepetido:32,AtributoRepetido:64,RelacionesFaltan:128,FuerteFalta:256,SuperFalta:512,SubFalta:1024,NoHaySuficientesEntidades:2048},objetoActual=null,ERMaker=function(){function ERMaker(){_classCallCheck(this,ERMaker)}return _createClass(ERMaker,null,[{key:"crearDiagrama",value:function(capa){return new DiagramaER(capa,4e3,4e3)}},{key:"clickObjeto",value:function(objeto){ERMaker.estadoAplicacion==ESTADO_APLICACION.Borrando&&(objeto.borrar(),(objeto.tipo==TIPO_ER.Entidad||objeto.tipo==TIPO_ER.Debil||objeto.tipo==TIPO_ER.Relacion||objeto.tipo==TIPO_ER.ISA)&&ERMaker.listaObjetos.quitar(objeto),ERMaker.estadoAplicacion=ESTADO_APLICACION.Normal,$("#btBorrar").removeClass("botonSeleccionado")),ERMaker.estadoAplicacion==ESTADO_APLICACION.Editando&&(objeto.editar(),ERMaker.estadoAplicacion=ESTADO_APLICACION.Normal,$("#btEditar").removeClass("botonSeleccionado"))}},{key:"limpiar",value:function(){}},{key:"obtenerListaEntidades",value:function(){var listaEntidades=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=ERMaker.listaObjetos[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var e=_step.value;(e.tipo==TIPO_ER.Entidad||e.tipo==TIPO_ER.Debil)&&listaEntidades.push(e)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return listaEntidades.sort(compararObjetoER),listaEntidades}},{key:"obtenerEntidadesYRelaciones",value:function(){var listaObjetos=[],_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=ERMaker.listaObjetos[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var objeto=_step2.value;(objeto.tipo==TIPO_ER.Entidad||objeto.tipo==TIPO_ER.Debil||objeto.tipo==TIPO_ER.Relacion)&&listaObjetos.push(objeto)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}return listaObjetos.sort(compararObjetoER),listaObjetos}},{key:"buscarObjetoPorNombre",value:function(nombre){var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=ERMaker.listaObjetos[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var e=_step3.value;if(e.nombre.toUpperCase()==nombre.toUpperCase())return e}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}return!1}},{key:"buscarObjetoPorNombreYTipo",value:function(nombre,tipo){var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=ERMaker.listaObjetos[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var e=_step4.value;if(e.nombre.toUpperCase()==nombre.toUpperCase()&&e.tipo==tipo)return e}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4["return"]&&_iterator4["return"]()}finally{if(_didIteratorError4)throw _iteratorError4}}return!1}},{key:"buscarEntidad",value:function(nombre){var entidad=ERMaker.buscarObjetoPorNombreYTipo(nombre,TIPO_ER.Entidad);return entidad||(entidad=ERMaker.buscarObjetoPorNombreYTipo(nombre,TIPO_ER.Debil)),entidad}},{key:"buscarRelacion",value:function(nombre){return ERMaker.buscarObjetoPorNombreYTipo(nombre,TIPO_ER.Relacion)}},{key:"buscarEntidadORelacion",value:function(nombre){var obj=ERMaker.buscarObjetoPorNombre(nombre);return!obj||obj.tipo!=TIPO_ER.Entidad&&obj.tipo!=TIPO_ER.Relacion&&obj.tipo!=TIPO_ER.Debil?!1:obj}},{key:"contarTiposObjeto",value:function(tipo){var cont=0,_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=ERMaker.listaObjetos[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var e=_step5.value;e.tipo==tipo&&cont++}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5["return"]&&_iterator5["return"]()}finally{if(_didIteratorError5)throw _iteratorError5}}return cont}},{key:"guardarJSON",value:function(archivo){var entidades=[],debiles=[],relaciones=[],isas=[],_iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=ERMaker.listaObjetos[Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var objeto=_step6.value;objeto.tipo==TIPO_ER.Entidad?entidades.push(objeto):objeto.tipo==TIPO_ER.Debil?debiles.push(objeto):objeto.tipo==TIPO_ER.Relacion?relaciones.push(objeto):objeto.tipo==TIPO_ER.ISA&&isas.push(objeto)}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{!_iteratorNormalCompletion6&&_iterator6["return"]&&_iterator6["return"]()}finally{if(_didIteratorError6)throw _iteratorError6}}var listaObjetos={};listaObjetos.entidades=[];var i=0,j=0,_iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;try{for(var _step7,_iterator7=entidades[Symbol.iterator]();!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){var entidad=_step7.value;listaObjetos.entidades[i]={},listaObjetos.entidades[i].nombre=entidad.nombre,listaObjetos.entidades[i].x=entidad.x,listaObjetos.entidades[i].y=entidad.y,listaObjetos.entidades[i].transform=entidad.caja.forma.transform(),listaObjetos.entidades[i].atributos=[],j=0;var _iteratorNormalCompletion11=!0,_didIteratorError11=!1,_iteratorError11=void 0;try{for(var _step11,_iterator11=entidad.listaAtributos[Symbol.iterator]();!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=!0){var atributo=_step11.value;listaObjetos.entidades[i].atributos[j]={},listaObjetos.entidades[i].atributos[j].x=atributo.x,listaObjetos.entidades[i].atributos[j].y=atributo.y,listaObjetos.entidades[i].atributos[j].nombre=atributo.nombre,listaObjetos.entidades[i].atributos[j].tipo=atributo.tipoAtributo,listaObjetos.entidades[i].atributos[j].transform=atributo.caja.forma.transform(),listaObjetos.entidades[i].atributos[j].relX=atributo.relX,listaObjetos.entidades[i].atributos[j].relY=atributo.relY,j++}}catch(err){_didIteratorError11=!0,_iteratorError11=err}finally{try{!_iteratorNormalCompletion11&&_iterator11["return"]&&_iterator11["return"]()}finally{if(_didIteratorError11)throw _iteratorError11}}i++}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{!_iteratorNormalCompletion7&&_iterator7["return"]&&_iterator7["return"]()}finally{if(_didIteratorError7)throw _iteratorError7}}listaObjetos.debiles=[],i=0;var _iteratorNormalCompletion8=!0,_didIteratorError8=!1,_iteratorError8=void 0;try{for(var _step8,_iterator8=debiles[Symbol.iterator]();!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=!0){var debil=_step8.value;listaObjetos.debiles[i]={},listaObjetos.debiles[i].nombre=debil.nombre,listaObjetos.debiles[i].x=debil.x,listaObjetos.debiles[i].y=debil.y,listaObjetos.debiles[i].transform=debil.caja.forma.transform(),listaObjetos.debiles[i].fuerte=debil.fuerte.nombre,listaObjetos.debiles[i].atributos=[],j=0;var _iteratorNormalCompletion12=!0,_didIteratorError12=!1,_iteratorError12=void 0;try{for(var _step12,_iterator12=debil.listaAtributos[Symbol.iterator]();!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=!0){var atributo=_step12.value;listaObjetos.debiles[i].atributos[j]={},listaObjetos.debiles[i].atributos[j].x=atributo.x,listaObjetos.debiles[i].atributos[j].y=atributo.y,listaObjetos.debiles[i].atributos[j].nombre=atributo.nombre,listaObjetos.debiles[i].atributos[j].tipo=atributo.tipoAtributo,listaObjetos.debiles[i].atributos[j].transform=atributo.caja.forma.transform(),listaObjetos.debiles[i].atributos[j].relX=atributo.relX,listaObjetos.debiles[i].atributos[j].relY=atributo.relY,j++}}catch(err){_didIteratorError12=!0,_iteratorError12=err}finally{try{!_iteratorNormalCompletion12&&_iterator12["return"]&&_iterator12["return"]()}finally{if(_didIteratorError12)throw _iteratorError12}}i++}}catch(err){_didIteratorError8=!0,_iteratorError8=err}finally{try{!_iteratorNormalCompletion8&&_iterator8["return"]&&_iterator8["return"]()}finally{if(_didIteratorError8)throw _iteratorError8}}listaObjetos.relaciones=[],i=0;var _iteratorNormalCompletion9=!0,_didIteratorError9=!1,_iteratorError9=void 0;try{for(var _step9,_iterator9=relaciones[Symbol.iterator]();!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=!0){var relacion=_step9.value;listaObjetos.relaciones[i]={},listaObjetos.relaciones[i].nombre=relacion.nombre,listaObjetos.relaciones[i].x=relacion.x,listaObjetos.relaciones[i].y=relacion.y,listaObjetos.relaciones[i].transform=relacion.caja.forma.transform(),listaObjetos.relaciones[i].cardinalidades=[],j=0;var _iteratorNormalCompletion13=!0,_didIteratorError13=!1,_iteratorError13=void 0;try{for(var _step13,_iterator13=relacion.lineasRelacion[Symbol.iterator]();!(_iteratorNormalCompletion13=(_step13=_iterator13.next()).done);_iteratorNormalCompletion13=!0){var linea=_step13.value;listaObjetos.relaciones[i].cardinalidades[j]={},listaObjetos.relaciones[i].cardinalidades[j].min=linea.cajaCardinalidad.minima,listaObjetos.relaciones[i].cardinalidades[j].max=linea.cajaCardinalidad.maxima,listaObjetos.relaciones[i].cardinalidades[j].entidad=linea.entidad.nombre,j++}}catch(err){_didIteratorError13=!0,_iteratorError13=err}finally{try{!_iteratorNormalCompletion13&&_iterator13["return"]&&_iterator13["return"]()}finally{if(_didIteratorError13)throw _iteratorError13}}listaObjetos.relaciones[i].atributos=[],j=0;var _iteratorNormalCompletion14=!0,_didIteratorError14=!1,_iteratorError14=void 0;try{for(var _step14,_iterator14=relacion.listaAtributos[Symbol.iterator]();!(_iteratorNormalCompletion14=(_step14=_iterator14.next()).done);_iteratorNormalCompletion14=!0){var atributo=_step14.value;listaObjetos.relaciones[i].atributos[j]={},listaObjetos.relaciones[i].atributos[j].x=atributo.x,listaObjetos.relaciones[i].atributos[j].y=atributo.y,listaObjetos.relaciones[i].atributos[j].nombre=atributo.nombre,listaObjetos.relaciones[i].atributos[j].tipo=atributo.tipoAtributo,listaObjetos.relaciones[i].atributos[j].transform=atributo.caja.forma.transform(),listaObjetos.relaciones[i].atributos[j].relX=atributo.relX,listaObjetos.relaciones[i].atributos[j].relY=atributo.relY,j++}}catch(err){_didIteratorError14=!0,_iteratorError14=err}finally{try{!_iteratorNormalCompletion14&&_iterator14["return"]&&_iterator14["return"]()}finally{if(_didIteratorError14)throw _iteratorError14}}i++}}catch(err){_didIteratorError9=!0,_iteratorError9=err}finally{try{!_iteratorNormalCompletion9&&_iterator9["return"]&&_iterator9["return"]()}finally{if(_didIteratorError9)throw _iteratorError9}}listaObjetos.relacionesISA=[],i=0;var _iteratorNormalCompletion10=!0,_didIteratorError10=!1,_iteratorError10=void 0;try{for(var _step10,_iterator10=isas[Symbol.iterator]();!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=!0){var isa=_step10.value;listaObjetos.relacionesISA[i]={},listaObjetos.relacionesISA[i].x=isa.x,listaObjetos.relacionesISA[i].y=isa.y,listaObjetos.relacionesISA[i].esTotal=isa.esTotal,listaObjetos.relacionesISA[i].esExclusiva=isa.esExclusiva,listaObjetos.relacionesISA[i].transform=isa.caja.forma.transform(),listaObjetos.relacionesISA[i].superE=isa.superEntidad.nombre,listaObjetos.relacionesISA[i].subs=[],j=0;var _iteratorNormalCompletion15=!0,_didIteratorError15=!1,_iteratorError15=void 0;try{for(var _step15,_iterator15=isa.subEntidades[Symbol.iterator]();!(_iteratorNormalCompletion15=(_step15=_iterator15.next()).done);_iteratorNormalCompletion15=!0){var sub=_step15.value;listaObjetos.relacionesISA[i].subs[j]=sub.nombre,j++}}catch(err){_didIteratorError15=!0,_iteratorError15=err}finally{try{!_iteratorNormalCompletion15&&_iterator15["return"]&&_iterator15["return"]()}finally{if(_didIteratorError15)throw _iteratorError15}}i++}}catch(err){_didIteratorError10=!0,_iteratorError10=err}finally{try{!_iteratorNormalCompletion10&&_iterator10["return"]&&_iterator10["return"]()}finally{if(_didIteratorError10)throw _iteratorError10}}var json=JSON.stringify(listaObjetos),a=document.createElement("a");a.download=archivo,a.type="tex/plain";var blob=new Blob([json],{type:"application/json;charset=utf-8"});a.href=(window.URL||webkitURL).createObjectURL(blob),a.click()}},{key:"borrar",value:function(obj){(obj.tipo==TIPO_ER.Entidad||obj.tipo==TIPO_ER.Debil||obj.tipo==TIPO_ER.Relacion||obj.tipo==TIPO_ER.ISA)&&ERMaker.listaObjetos.quitar(obj),obj.borrar()}},{key:"editar",value:function(obj){obj instanceof ObjetoER&&(obj.tipo==TIPO_ER.Entidad?new DialogoEditarEntidad(obj):obj.tipo==TIPO_ER.Debil?new DialogoEditarEntidad(obj):obj.tipo==TIPO_ER.Relacion?new DialogoEditarRelacion(obj):obj.tipo==TIPO_ER.ISA?new DialogoEditarISA(obj):obj.tipo==TIPO_ER.Atributo?new DialogoEditarAtributo(obj):obj.tipo==TIPO_ER.Cardinalidad&&new DialogoEditarCardinalidad(obj),$("#pantallaBlanca").fadeIn(1e3),$(".dialogo").fadeIn(1e3))}},{key:"cargarJSON",value:function(archivo){var reader=new FileReader;reader.onload=function(e){var text=reader.result;ERMaker.crearDiagramaDesdeJSON(text)},reader.readAsText(archivo)}},{key:"crearDiagramaDesdeJSON",value:function(textoJSON){var obj=JSON.parse(textoJSON);ERMaker.borrarDiagrama();var _iteratorNormalCompletion16=!0,_didIteratorError16=!1,_iteratorError16=void 0;try{for(var _step16,_iterator16=obj.entidades[Symbol.iterator]();!(_iteratorNormalCompletion16=(_step16=_iterator16.next()).done);_iteratorNormalCompletion16=!0){var entidad=_step16.value,e=new Entidad(entidad.nombre,0,0,ERMaker.diagrama);e.conjunto.set.transform(entidad.transform);var _iteratorNormalCompletion20=!0,_didIteratorError20=!1,_iteratorError20=void 0;try{for(var _step20,_iterator20=entidad.atributos[Symbol.iterator]();!(_iteratorNormalCompletion20=(_step20=_iterator20.next()).done);_iteratorNormalCompletion20=!0){var atributo=_step20.value,a=new Atributo(atributo.nombre,atributo.x,atributo.y,ERMaker.diagrama,e,atributo.tipo);a.relX=atributo.relX,a.relY=atributo.relY,a.conjunto.set.transform(atributo.transform),a.redibujar()}}catch(err){_didIteratorError20=!0,_iteratorError20=err}finally{try{!_iteratorNormalCompletion20&&_iterator20["return"]&&_iterator20["return"]()}finally{if(_didIteratorError20)throw _iteratorError20}}e.redibujar(),ERMaker.listaObjetos.push(e)}}catch(err){_didIteratorError16=!0,_iteratorError16=err}finally{try{!_iteratorNormalCompletion16&&_iterator16["return"]&&_iterator16["return"]()}finally{if(_didIteratorError16)throw _iteratorError16}}var _iteratorNormalCompletion17=!0,_didIteratorError17=!1,_iteratorError17=void 0;try{for(var _step17,_iterator17=obj.debiles[Symbol.iterator]();!(_iteratorNormalCompletion17=(_step17=_iterator17.next()).done);_iteratorNormalCompletion17=!0){var debil=_step17.value,fuerte=ERMaker.buscarEntidad(debil.fuerte),d=new Debil(debil.nombre,0,0,ERMaker.diagrama,fuerte);d.conjunto.set.transform(debil.transform);var _iteratorNormalCompletion21=!0,_didIteratorError21=!1,_iteratorError21=void 0;try{for(var _step21,_iterator21=debil.atributos[Symbol.iterator]();!(_iteratorNormalCompletion21=(_step21=_iterator21.next()).done);_iteratorNormalCompletion21=!0){var atributo=_step21.value,a=new Atributo(atributo.nombre,atributo.x,atributo.y,ERMaker.diagrama,d,atributo.tipo);a.relX=atributo.relX,a.relY=atributo.relY,a.conjunto.set.transform(atributo.transform),a.redibujar()}}catch(err){_didIteratorError21=!0,_iteratorError21=err}finally{try{!_iteratorNormalCompletion21&&_iterator21["return"]&&_iterator21["return"]()}finally{if(_didIteratorError21)throw _iteratorError21}}d.redibujar(),ERMaker.listaObjetos.push(d)}}catch(err){_didIteratorError17=!0,_iteratorError17=err}finally{try{!_iteratorNormalCompletion17&&_iterator17["return"]&&_iterator17["return"]()}finally{if(_didIteratorError17)throw _iteratorError17}}var _iteratorNormalCompletion18=!0,_didIteratorError18=!1,_iteratorError18=void 0;try{for(var _step18,_iterator18=obj.relaciones[Symbol.iterator]();!(_iteratorNormalCompletion18=(_step18=_iterator18.next()).done);_iteratorNormalCompletion18=!0){var relacion=_step18.value,cardinalidades=[],_iteratorNormalCompletion22=!0,_didIteratorError22=!1,_iteratorError22=void 0;try{for(var _step22,_iterator22=relacion.cardinalidades[Symbol.iterator]();!(_iteratorNormalCompletion22=(_step22=_iterator22.next()).done);_iteratorNormalCompletion22=!0){var card=_step22.value;cardinalidades.push(new Cardinalidad(card.min,card.max,ERMaker.buscarEntidad(card.entidad)))}}catch(err){_didIteratorError22=!0,_iteratorError22=err}finally{try{!_iteratorNormalCompletion22&&_iterator22["return"]&&_iterator22["return"]()}finally{if(_didIteratorError22)throw _iteratorError22}}var r=new Relacion(relacion.nombre,0,0,ERMaker.diagrama,cardinalidades);r.conjunto.set.transform(relacion.transform);var _iteratorNormalCompletion23=!0,_didIteratorError23=!1,_iteratorError23=void 0;try{for(var _step23,_iterator23=relacion.atributos[Symbol.iterator]();!(_iteratorNormalCompletion23=(_step23=_iterator23.next()).done);_iteratorNormalCompletion23=!0){var atributo=_step23.value,a=new Atributo(atributo.nombre,atributo.x,atributo.y,ERMaker.diagrama,r,atributo.tipo);a.relX=atributo.relX,a.relY=atributo.relY,a.conjunto.set.transform(atributo.transform),a.redibujar()}}catch(err){_didIteratorError23=!0,_iteratorError23=err}finally{try{!_iteratorNormalCompletion23&&_iterator23["return"]&&_iterator23["return"]()}finally{if(_didIteratorError23)throw _iteratorError23}}r.redibujar(),ERMaker.listaObjetos.push(r)}}catch(err){_didIteratorError18=!0,_iteratorError18=err}finally{try{!_iteratorNormalCompletion18&&_iterator18["return"]&&_iterator18["return"]()}finally{if(_didIteratorError18)throw _iteratorError18}}var _iteratorNormalCompletion19=!0,_didIteratorError19=!1,_iteratorError19=void 0;try{for(var _step19,_iterator19=obj.relacionesISA[Symbol.iterator]();!(_iteratorNormalCompletion19=(_step19=_iterator19.next()).done);_iteratorNormalCompletion19=!0){var isa=_step19.value,subs=[],_iteratorNormalCompletion24=!0,_didIteratorError24=!1,_iteratorError24=void 0;try{for(var _step24,_iterator24=isa.subs[Symbol.iterator]();!(_iteratorNormalCompletion24=(_step24=_iterator24.next()).done);_iteratorNormalCompletion24=!0){var sub=_step24.value;subs.push(ERMaker.buscarEntidad(sub))}}catch(err){_didIteratorError24=!0,_iteratorError24=err}finally{try{!_iteratorNormalCompletion24&&_iterator24["return"]&&_iterator24["return"]()}finally{if(_didIteratorError24)throw _iteratorError24}}var r=new RelacionISA(ERMaker.buscarEntidad(isa.superE),subs,0,0,ERMaker.diagrama,isa.esExclusiva,isa.esTotal);r.conjunto.set.transform(isa.transform),r.redibujar(),ERMaker.listaObjetos.push(r)}}catch(err){_didIteratorError19=!0,_iteratorError19=err}finally{try{!_iteratorNormalCompletion19&&_iterator19["return"]&&_iterator19["return"]()}finally{if(_didIteratorError19)throw _iteratorError19}}}},{key:"borrarDiagrama",value:function(){ERMaker.diagrama.paper.remove(),ERMaker.listaObjetos=[],ERMaker.diagrama=new DiagramaER("lienzo",4e3,4e3)}}]),ERMaker}();ERMaker.estadoAplicacion=ESTADO_APLICACION.Normal,ERMaker.objetoActual=null,ERMaker.diagrama=new DiagramaER("lienzo",4e3,4e3),ERMaker.listaObjetos=[];var Dialogo=function(){function Dialogo(titulo){var _this2=this;_classCallCheck(this,Dialogo),this.datos={},this.titulo=titulo,this.caja=$(document.createElement("div")),this.caja.addClass("dialogo"),this.caja.append('<div class="tituloDialogo"><h1 id="tituloTexto">'+titulo+'</h1></div><div class="cerrarDialogo"></div><div class="capaBotones"><button class="btAceptar botonCentrado" type="button"  id="btAceptarCuadroTexto">Aceptar</button></div>'),$("body").append(this.caja),this.caja.find(".cerrarDialogo").on("click",function(e){$("#pantallaBlanca").fadeOut(500),_this2.caja.fadeOut(500,function(){_this2.caja.remove()})}),this.caja.find(".btAceptar").on("click",function(e){var codigoError=_this2.comprobarErrores();0==codigoError?(_this2.realizarAccion(),$("#pantallaBlanca").fadeOut(500),$("#pantallaBlancaError").fadeOut(500),_this2.caja.fadeOut(500,function(){_this2.caja.remove()})):Dialogo.mostrarError(codigoError)})}return _createClass(Dialogo,[{key:"comprobarErrores",value:function(){return!1}},{key:"realizarAccion",value:function(){}}],[{key:"mostrarError",value:function(codigo){codigo=parseInt(codigo);var txt="<ul>";codigo&ERROR.NombreCorto?txt+="<li>Hay que escribir un nombre</li>":codigo&ERROR.NombreLargo&&(txt+="<li>El nombre es demasiado largo</li>"),codigo&ERROR.NombreNoCumple&&(txt+="<li>El nombre debe empezar por una letra y, después,  solo se permiten más letras, números o símbolos de guion bajo</li>"),codigo&ERROR.AtributoNoCumple&&(txt+="<li>Hay atributos con nombres no válidos (deben empezar por una letra y, después,  solo puede tener letras y números)</li>"),codigo&ERROR.NoHayEntidad&&(txt+="<li>No hay ninguna entidad todavía</li>"),codigo&ERROR.NoHaySuficientesEntidades&&(txt+="<li>No hay suficientes entidades todavía</li>"),codigo&ERROR.NombreRepetido&&(txt+="<li>Ya existe ese nombre de entidad o relación</li>"),codigo&ERROR.AtributoRepetido&&(txt+="<li>Hay nombres de atributo repetidos</li>"),codigo&ERROR.RelacionesFaltan&&(txt+="<li>Al menos hay que elegir dos entidades para relacionar</li>"),codigo&ERROR.FuerteFalta&&(txt+="<li>Se requiere elegir la entidad fuerte</li>"),codigo&ERROR.SuperFalta&&(txt+="<li>Se requiere elegir una superentidad</li>"),codigo&ERROR.SubFalta&&(txt+="<li>Se requiere elegir al menos una subentidad</li>"),txt+="</ul>;",new DialogoError(txt),$("#pantallaBlancaError").fadeIn(1e3),$(".error").fadeIn(1e3)}}]),Dialogo}(),DialogoError=function DialogoError(mensaje){var _this3=this,titulo=arguments.length<=1||void 0===arguments[1]?"error":arguments[1];_classCallCheck(this,DialogoError),this.caja=$(document.createElement("div")),this.caja.addClass("dialogo"),this.caja.append('<div class="tituloDialogo"><h1 id="tituloTexto">'+titulo+'</h1></div><div class="cerrarDialogo"></div><div class="capaBotones"><button class="btAceptar botonCentrado" type="button"  id="btAceptarCuadroTexto">Aceptar</button></div><div class="capaError"><p>'+mensaje+"</p></div>"),this.caja.addClass("error"),this.caja.find(".btAceptar").addClass("botonError"),$("body").append(this.caja),this.caja.find(".cerrarDialogo").on("click",function(e){$("#pantallaBlancaError").fadeOut(500),_this3.caja.fadeOut(500,function(){_this3.caja.remove()})}),this.caja.find(".btAceptar").on("click",function(e){$("#pantallaBlancaError").fadeOut(500),_this3.caja.fadeOut(500,function(){_this3.caja.remove()})})},DialogoNuevoObjeto=function(_Dialogo){function DialogoNuevoObjeto(titulo,label,valorInicial){_classCallCheck(this,DialogoNuevoObjeto),_get(Object.getPrototypeOf(DialogoNuevoObjeto.prototype),"constructor",this).call(this,titulo),this.caja.append('<div class="capaNombre"><p><label for="tNombre">'+label+'</label><br/>   <input type="text" id="tNombre" maxlength="30" value="'+valorInicial+'"/></p></div>'),$("#tNombre").select()}return _inherits(DialogoNuevoObjeto,_Dialogo),_createClass(DialogoNuevoObjeto,[{key:"comprobarErrores",value:function(){var exprValidacion=VALIDACION_NOMBRE,errores=0,nombre=$("#tNombre").val();return this.datos.nombre=nombre,nombre.length<1?errores=ERROR.NombreCorto:nombre.length>30?errores+=ERROR.NombreLargo:0==exprValidacion.test(nombre)&&(errores+=ERROR.NombreNoCumple),errores}},{key:"realizarAccion",value:function(){this.datos.nombre=this.caja.find("#tNombre").val()}}]),DialogoNuevoObjeto}(Dialogo),DialogoNuevaEntidad=function(_DialogoNuevoObjeto){function DialogoNuevaEntidad(){_classCallCheck(this,DialogoNuevaEntidad),_get(Object.getPrototypeOf(DialogoNuevaEntidad.prototype),"constructor",this).call(this,"Nueva Entidad","Nombre","Entidad"+(ERMaker.contarTiposObjeto(TIPO_ER.Entidad)+1)),this.datos.atributos=[],this.caja.addClass("dialogoMedio"),this.caja.append('<div class="capaAtributos"><table class="tablaAtributos"><tr><td><span class="label labelGrande">Atributos</span></td><td><span class="label">Clave</span></td><td><span class="label">Alt.</span></td></td></tr></table><div class="capaListaAtributos"><table class="tablaAtributos"><tr id="lineaAtributo1" class="lineaAtributo"><td><label for="tAtributo1">1</label><input type="text" class="atributo" id="tAtributo1"maxlength="30"/><img src="img/btMas.png" class="iconoPeque btMas" alt="Mas" id="btMas"/></td><td><input type="checkbox" id="rPK1"></td><td><input type="checkbox" id="cAlt1"></td></tr></div></div>');var _this=this;this.caja.find(".btMas").hover(function(e){$(this).attr("src","img/btMasSel.png")},function(e){$(this).attr("src","img/btMas.png")}).click(function(e){var id=$(this).parent().parent().attr("id"),nId=id.substr("lineaAtributo".length);nId++;var cont=_this.caja.find(".lineaAtributo").length+1;_this.caja.find("#"+id).after('<tr id="lineaAtributo'+nId+'" class="lineaAtributo"><td><label for="tAtributo'+nId+'">'+cont+'</label><input type="text" class="atributo" id="tAtributo'+nId+'"maxlength="30"/><img src="img/btQuitar.png" class="iconoPeque btQuitar" alt="Quitar" id="btQuitar'+nId+'"/></td><td><input type="checkbox" id="rPK'+nId+'"></td><td><input type="checkbox" id="cAlt'+nId+'"></td></tr>'),_this.caja.find("#btQuitar"+nId).after(_this.caja.find("#btMas")),_this.caja.find("#btQuitar"+nId).hover(function(e){$(this).attr("src","img/btQuitarSel.png")},function(e){$(this).attr("src","img/btQuitar.png")}).click(function(e){{var id=$(this).attr("id");id.substr("btQuitar".length)}_this.caja.find(".lineaAtributo").length<=2&&_this.caja.find("#tAtributo1").after($("#btMas")),$(_this.caja.find(".btQuitar")[_this.caja.find(".btQuitar").length-1]).attr("id")==$(this).attr("id")&&$(_this.caja.find(".btQuitar")[_this.caja.find(".btQuitar").length-2]).after($("#btMas")),$(this).parent().parent().remove(),$(".lineaAtributo label").each(function(i){$(this).text(i+1)})}),_this.caja.find(".capaListaAtributos").scrollTop(1e4)}),this.caja.find("#btQuitar1").hover(function(e){$(this).attr("src","img/btQuitarSel.png")},function(e){$(this).attr("src","img/btQuitar.png")}).click(function(e){_this.caja.find("#lineaAtributo1").remove()})}return _inherits(DialogoNuevaEntidad,_DialogoNuevoObjeto),_createClass(DialogoNuevaEntidad,[{key:"comprobarErrores",value:function(){for(var codigo=_get(Object.getPrototypeOf(DialogoNuevaEntidad.prototype),"comprobarErrores",this).call(this),atributosCorrectos=!0,array=this.caja.find(".lineaAtributo input.atributo"),i=0;i<array.length;i++){var nombreAtributo=$(array[i]).val();if(nombreAtributo&&0==VALIDACION_NOMBRE.test(nombreAtributo)){atributosCorrectos=!1,codigo+=ERROR.AtributoNoCumple;break}if(nombreAtributo.length>0){for(var j=i+1;j<this.caja.find(".lineaAtributo input").length;j++)if($(array[i]).val()==$(array[j]).val()){atributosCorrectos=!1,codigo+=ERROR.AtributoRepetido;break}if(!atributosCorrectos)break}}return ERMaker.listaObjetos.length>0&&ERMaker.buscarEntidadORelacion(this.datos.nombre)&&(codigo+=ERROR.NombreRepetido),codigo}},{key:"realizarAccion",value:function(){_get(Object.getPrototypeOf(DialogoNuevaEntidad.prototype),"realizarAccion",this).call(this),ERMaker.objetoActual=new Entidad(this.datos.nombre,0,0,ERMaker.diagrama);var _this=this;if(this.caja.find(".atributo").each(function(i){var objAtributo={},nombreAtributo=$(this).val(),id=$(this).attr("id").substr("tAtributo".length);objAtributo.nombre=nombreAtributo,objAtributo.tipo=TIPO_ATRIBUTO.Normal,_this.caja.find("#rPK"+id).is(":checked")&&(objAtributo.tipo=TIPO_ATRIBUTO.Clave),_this.caja.find("#cAlt"+id).is(":checked")&&(objAtributo.tipo=TIPO_ATRIBUTO.Alternativo),nombreAtributo&&_this.datos.atributos.push(objAtributo)}),this.datos.atributos.length>0){var radio=ERMaker.objetoActual.texto.forma.getBBox().width,angulo=360/this.datos.atributos.length,contAngulo=45,_iteratorNormalCompletion25=!0,_didIteratorError25=!1,_iteratorError25=void 0;try{for(var _step25,_iterator25=this.datos.atributos[Symbol.iterator]();!(_iteratorNormalCompletion25=(_step25=_iterator25.next()).done);_iteratorNormalCompletion25=!0){var atributo=_step25.value,atributoER=new Atributo(atributo.nombre,radio*Math.sin(Raphael.rad(contAngulo)),radio*Math.cos(Raphael.rad(contAngulo)),ERMaker.diagrama,ERMaker.objetoActual,atributo.tipo);atributoER.conjunto.set.attr("opacity",.25),contAngulo+=angulo}}catch(err){_didIteratorError25=!0,_iteratorError25=err}finally{try{!_iteratorNormalCompletion25&&_iterator25["return"]&&_iterator25["return"]()}finally{if(_didIteratorError25)throw _iteratorError25}}}ERMaker.estadoAplicacion=ESTADO_APLICACION.Anadiendo,ERMaker.objetoActual.conjunto.set.attr("opacity",.25)}}]),DialogoNuevaEntidad}(DialogoNuevoObjeto),DialogoEditarEntidad=function(_DialogoNuevoObjeto2){function DialogoEditarEntidad(entidad){_classCallCheck(this,DialogoEditarEntidad),_get(Object.getPrototypeOf(DialogoEditarEntidad.prototype),"constructor",this).call(this,"Editar Entidad","Nombre",entidad.nombre),this.entidad=entidad}return _inherits(DialogoEditarEntidad,_DialogoNuevoObjeto2),_createClass(DialogoEditarEntidad,[{key:"realizarAccion",value:function(){this.entidad.nombre=$("#tNombre").val()}}]),DialogoEditarEntidad}(DialogoNuevoObjeto),DialogoNuevaRelacion=function(_DialogoNuevoObjeto3){function DialogoNuevaRelacion(){_classCallCheck(this,DialogoNuevaRelacion),_get(Object.getPrototypeOf(DialogoNuevaRelacion.prototype),"constructor",this).call(this,"Nueva Relación","Nombre","Relacion"+(ERMaker.contarTiposObjeto(TIPO_ER.Entidad)+1)),this.datos.atributos=[],this.datos.entidades=[],this.caja.addClass("dialogoMedio");var listaEntidades=ERMaker.obtenerListaEntidades(),option="<option value='' disable selected></option>",optionMin="<option value='1'>1</option><option value='0'>0</option>",optionMax="<option value='n'>n</option><option value='1'>1</option>",_iteratorNormalCompletion26=!0,_didIteratorError26=!1,_iteratorError26=void 0;

try{for(var _step26,_iterator26=listaEntidades[Symbol.iterator]();!(_iteratorNormalCompletion26=(_step26=_iterator26.next()).done);_iteratorNormalCompletion26=!0){var entidad=_step26.value;option+="<option value='"+entidad.nombre+"'>"+entidad.nombre+"</option>"}}catch(err){_didIteratorError26=!0,_iteratorError26=err}finally{try{!_iteratorNormalCompletion26&&_iterator26["return"]&&_iterator26["return"]()}finally{if(_didIteratorError26)throw _iteratorError26}}this.caja.append('<div class="capaAtributos"><p><span class="label">Atributos</span><p><div class="capaListaAtributos capaListaAtributosMin"><div class="lineaAtributo" id="lineaAtributo1"><label for="tAtributo1">1</label><input type="text" class="atributo" id="tAtributo1"maxlength="30"/><img src="img/btMas.png" class="iconoPeque btMas" alt="Mas" id="btMas"/></div></div></div><div class="capaEntidades"><table class="tablaEntidades"><tr><td><span class="label">Entidades</span></td><td><span class="label">Min</span></td><td><span class="label">Max</span></td></tr></table><div class="capaListaEntidades"><table id="lineaEntidad1"  class="tablaEntidades"><tr id="lineaEntidad1" class="lineaEntidad"><td><label for="sEntidad1">1</label><select class="entidad" id="sEntidad1">'+option+'</select><td><select class="min" id="sMin1">'+optionMin+'</select></td><td><select class="max" id="sMax1">'+optionMax+'</select></td></tr><tr id="lineaEntidad2" class="lineaEntidad"><td><label for="sEntidad2">2</label>"<select class="entidad" id="sEntidad2">'+option+'</select><img src="img/btMas.png" class="iconoPeque btMasE" alt="Mas" id="btMasE"/></td><td><select class="min" id="sMin2">'+optionMin+'</select></td><td><select class="max" id="sMax2">'+optionMax+"</select></td></tr></table></div></div>");var _this=this;this.caja.find(".btMas").hover(function(e){$(this).attr("src","img/btMasSel.png")},function(e){$(this).attr("src","img/btMas.png")}),$("#btMas").click(function(e){var id=$(this).parent().attr("id"),nId=id.substr("lineaAtributo".length);nId++;_this.caja.find(".lineaAtributo").length+1;_this.caja.find("#"+id).after('<div id="lineaAtributo'+nId+'" class="lineaAtributo"><label for="tAtributo'+nId+'" >'+nId+'</label><input type="text" class="atributo" id="tAtributo'+nId+'"maxlength="30"/><img src="img/btQuitar.png" class="iconoPeque btQuitar" alt="Quitar" id="btQuitar'+nId+'"/></div>'),_this.caja.find("#btQuitar"+nId).after(_this.caja.find("#btMas")),_this.caja.find(".btQuitar").hover(function(e){$(this).attr("src","img/btQuitarSel.png")},function(e){$(this).attr("src","img/btQuitar.png")}).click(function(e){{var id=$(this).attr("id");id.substr("btQuitar".length)}_this.caja.find(".atributo").length<=2&&_this.caja.find("#tAtributo1").after($("#btMas")),$(_this.caja.find(".btQuitar")[_this.caja.find(".btQuitar").length-1]).attr("id")==$(this).attr("id")&&$(_this.caja.find(".btQuitar")[_this.caja.find(".btQuitar").length-2]).after($("#btMas")),$(this).parent().remove(),$(".lineaAtributo label").each(function(i){$(this).text(i+1)})}),_this.caja.find(".capaListaAtributos").scrollTop(1e4)}),$("#btMasE").click(function(e){var id=$(this).parent().parent().attr("id"),nId=id.substr("lineaEntidad".length);nId++,_this.caja.find("#"+id).after('<tr id="lineaEntidad'+nId+'" class="lineaEntidad"><td><label for="sEntidad'+nId+'">'+nId+'</label><select class="entidad" id="sEntidad'+nId+'">'+option+'</select><img src="img/btQuitar.png" class="iconoPeque btQuitarE" alt="Quitar" id="btQuitarE'+nId+'"/></td><td><select class="min" id="sMin'+nId+'">'+optionMin+'</select></td><td><select class="max" id="sMax'+nId+'">'+optionMax+"</select></td></tr>"),_this.caja.find("#btQuitarE"+nId).after(_this.caja.find("#btMasE")),_this.caja.find(".btQuitarE").hover(function(e){$(this).attr("src","img/btQuitarSel.png")},function(e){$(this).attr("src","img/btQuitar.png")}).click(function(e){{var id=$(this).attr("id");id.substr("btQuitarE".length)}_this.caja.find(".lineaEntidad").length<=3&&_this.caja.find("#sEntidad2").after($("#btMasE")),$(_this.caja.find(".btQuitarE")[_this.caja.find(".btQuitarE").length-1]).attr("id")==$(this).attr("id")&&$(_this.caja.find(".btQuitarE")[_this.caja.find(".btQuitar").length-2]).after($("#btMasE")),$(this).parent().parent().remove(),$(".lineaEntidad label").each(function(i){$(this).text(i+1)})}),_this.caja.find(".capaListaEntidades").scrollTop(1e4)})}return _inherits(DialogoNuevaRelacion,_DialogoNuevoObjeto3),_createClass(DialogoNuevaRelacion,[{key:"comprobarErrores",value:function(){for(var codigo=_get(Object.getPrototypeOf(DialogoNuevaRelacion.prototype),"comprobarErrores",this).call(this),atributosCorrectos=!0,array=this.caja.find(".lineaAtributo input.atributo"),i=0;i<array.length;i++){var nombreAtributo=$(array[i]).val();if(nombreAtributo&&0==VALIDACION_NOMBRE.test(nombreAtributo)){atributosCorrectos=!1,codigo+=ERROR.AtributoNoCumple;break}if(nombreAtributo.length>0){for(var j=i+1;j<this.caja.find(".lineaAtributo input").length;j++)if($(array[i]).val()==$(array[j]).val()){atributosCorrectos=!1,codigo+=ERROR.AtributoRepetido;break}if(!atributosCorrectos)break}}ERMaker.listaObjetos.length>0&&ERMaker.buscarEntidadORelacion(this.datos.nombre)&&(codigo+=ERROR.NombreRepetido);var cont=0;return $(".entidad").each(function(i){$(this).val()&&cont++}),0==cont&&(codigo+=ERROR.RelacionesFaltan),codigo}},{key:"realizarAccion",value:function(){_get(Object.getPrototypeOf(DialogoNuevaRelacion.prototype),"realizarAccion",this).call(this);var _this=this,entidades=[];if(this.caja.find(".entidad").each(function(i){var nombre=$(this).val(),id=$(this).attr("id").substr("sEntidad".length);if(nombre){var e=ERMaker.buscarEntidad(nombre),c=new Cardinalidad($("#sMin"+id).val(),$("#sMax"+id).val(),e);entidades.push(c)}}),ERMaker.objetoActual=new Relacion(this.datos.nombre,0,0,ERMaker.diagrama,entidades),this.caja.find(".atributo").each(function(i){var nombreAtributo=$(this).val();nombreAtributo&&_this.datos.atributos.push(nombreAtributo)}),this.datos.atributos.length>0){var radio=ERMaker.objetoActual.texto.forma.getBBox().width,angulo=360/this.datos.atributos.length,contAngulo=45,arrayAtributos=[],_iteratorNormalCompletion27=!0,_didIteratorError27=!1,_iteratorError27=void 0;try{for(var _step27,_iterator27=this.datos.atributos[Symbol.iterator]();!(_iteratorNormalCompletion27=(_step27=_iterator27.next()).done);_iteratorNormalCompletion27=!0){var atributo=_step27.value,atributoER=new Atributo(atributo,radio*Math.sin(Raphael.rad(contAngulo)),radio*Math.cos(Raphael.rad(contAngulo)),ERMaker.diagrama,ERMaker.objetoActual);arrayAtributos.push(atributoER),atributoER.conjunto.set.attr("opacity",.25),contAngulo+=angulo}}catch(err){_didIteratorError27=!0,_iteratorError27=err}finally{try{!_iteratorNormalCompletion27&&_iterator27["return"]&&_iterator27["return"]()}finally{if(_didIteratorError27)throw _iteratorError27}}}ERMaker.estadoAplicacion=ESTADO_APLICACION.Anadiendo,ERMaker.objetoActual.conjunto.set.attr("opacity",.25)}}]),DialogoNuevaRelacion}(DialogoNuevoObjeto),DialogoEditarRelacion=function(_DialogoNuevoObjeto4){function DialogoEditarRelacion(relacion){_classCallCheck(this,DialogoEditarRelacion),_get(Object.getPrototypeOf(DialogoEditarRelacion.prototype),"constructor",this).call(this,"Editar Relación","Nombre",relacion.nombre),this.relacion=relacion}return _inherits(DialogoEditarRelacion,_DialogoNuevoObjeto4),_createClass(DialogoEditarRelacion,[{key:"realizarAccion",value:function(){this.relacion.nombre=$("#tNombre").val()}}]),DialogoEditarRelacion}(DialogoNuevoObjeto),DialogoNuevaDebil=function(_DialogoNuevaEntidad){function DialogoNuevaDebil(){_classCallCheck(this,DialogoNuevaDebil),_get(Object.getPrototypeOf(DialogoNuevaDebil.prototype),"constructor",this).call(this),this.datos.atributos=[],$("#tituloTexto").text("Nueva Entidad Débil");var option="<option value='' disable selected></option>",listaEntidades=ERMaker.obtenerListaEntidades(),_iteratorNormalCompletion28=!0,_didIteratorError28=!1,_iteratorError28=void 0;try{for(var _step28,_iterator28=listaEntidades[Symbol.iterator]();!(_iteratorNormalCompletion28=(_step28=_iterator28.next()).done);_iteratorNormalCompletion28=!0){var entidad=_step28.value;option+="<option value='"+entidad.nombre+"'>"+entidad.nombre+"</option>"}}catch(err){_didIteratorError28=!0,_iteratorError28=err}finally{try{!_iteratorNormalCompletion28&&_iterator28["return"]&&_iterator28["return"]()}finally{if(_didIteratorError28)throw _iteratorError28}}$(".capaNombre").after('<div class="capaFuerte"><p><label for="tFuerte">Entidad Fuerte</label><br/><select id="sFuerte">'+option+"</select></p></p></div>"),$(".capaAtributos").addClass("capaAtributosFuerte")}return _inherits(DialogoNuevaDebil,_DialogoNuevaEntidad),_createClass(DialogoNuevaDebil,[{key:"comprobarErrores",value:function(){var codigo=_get(Object.getPrototypeOf(DialogoNuevaDebil.prototype),"comprobarErrores",this).call(this);return 0==$("#sFuerte").val()&&(codigo+=ERROR.FuerteFalta),codigo}},{key:"realizarAccion",value:function(){var nombre=this.caja.find("#tNombre").val(),nombreFuerte=this.caja.find("#sFuerte").val(),fuerte=ERMaker.buscarEntidad(nombreFuerte),_this=this;ERMaker.objetoActual=new Debil(nombre,0,0,ERMaker.diagrama,fuerte);if(this.caja.find(".atributo").each(function(i){var objAtributo={},nombreAtributo=$(this).val(),id=$(this).attr("id").substr("tAtributo".length);objAtributo.nombre=nombreAtributo,objAtributo.tipo=TIPO_ATRIBUTO.Normal,_this.caja.find("#rPK"+id).is(":checked")&&(objAtributo.tipo=TIPO_ATRIBUTO.Clave),_this.caja.find("#cAlt"+id).is(":checked")&&(objAtributo.tipo=TIPO_ATRIBUTO.Alternativo),nombreAtributo&&_this.datos.atributos.push(objAtributo),console.log(objAtributo)}),this.datos.atributos.length>0){var radio=ERMaker.objetoActual.texto.forma.getBBox().width,angulo=360/this.datos.atributos.length,contAngulo=45,arrayAtributos=[],_iteratorNormalCompletion29=!0,_didIteratorError29=!1,_iteratorError29=void 0;try{for(var _step29,_iterator29=this.datos.atributos[Symbol.iterator]();!(_iteratorNormalCompletion29=(_step29=_iterator29.next()).done);_iteratorNormalCompletion29=!0){var atributo=_step29.value,atributoER=new Atributo(atributo.nombre,radio*Math.sin(Raphael.rad(contAngulo)),radio*Math.cos(Raphael.rad(contAngulo)),ERMaker.diagrama,ERMaker.objetoActual,atributo.tipo);arrayAtributos.push(atributoER),atributoER.conjunto.set.attr("opacity",.25),contAngulo+=angulo}}catch(err){_didIteratorError29=!0,_iteratorError29=err}finally{try{!_iteratorNormalCompletion29&&_iterator29["return"]&&_iterator29["return"]()}finally{if(_didIteratorError29)throw _iteratorError29}}}ERMaker.estadoAplicacion=ESTADO_APLICACION.Anadiendo,ERMaker.objetoActual.conjunto.set.attr("opacity",.25)}}]),DialogoNuevaDebil}(DialogoNuevaEntidad),DialogoNuevaISA=function(_Dialogo2){function DialogoNuevaISA(){_classCallCheck(this,DialogoNuevaISA),_get(Object.getPrototypeOf(DialogoNuevaISA.prototype),"constructor",this).call(this,"Nueva relación ISA");var option="<option value='' disable selected></option>",listaEntidades=ERMaker.obtenerListaEntidades(),_iteratorNormalCompletion30=!0,_didIteratorError30=!1,_iteratorError30=void 0;try{for(var _step30,_iterator30=listaEntidades[Symbol.iterator]();!(_iteratorNormalCompletion30=(_step30=_iterator30.next()).done);_iteratorNormalCompletion30=!0){var entidad=_step30.value;option+="<option value='"+entidad.nombre+"'>"+entidad.nombre+"</option>"}}catch(err){_didIteratorError30=!0,_iteratorError30=err}finally{try{!_iteratorNormalCompletion30&&_iterator30["return"]&&_iterator30["return"]()}finally{if(_didIteratorError30)throw _iteratorError30}}$(".dialogo").addClass("dialogoMedio"),$(".tituloDialogo").after('<div class="capaNombre"><p><label for="tSuper">Superentidad</label><br/><select id="sFuerte">'+option+'</select></p><table><tr><td style="width:50%"><label for="cTotal">Total</label><input type="checkbox" id="cTotal"/></td><td style="width:50%"><label for="cExclusiva">Exclusiva</label><input type="checkbox" id="cExclusiva" checked/></td></tr></table></div><div class="capaEntidades"><p><span class="label">Subentidades</label></p><div class="capaListaEntidades capaISA"><div id="lineaEntidad1" class="lineaEntidad"><select id="sEntidad1" class="entidad">'+option+'</select><img src="img/btMas.png" class="iconoPeque btMas" alt="Mas" id="btMas"/></div></div></div>');var _this=this;this.caja.find(".btMas").hover(function(e){$(this).attr("src","img/btMasSel.png")},function(e){$(this).attr("src","img/btMas.png")}).click(function(e){var id=$(this).parent().attr("id"),nId=id.substr("lineaEntidad".length);nId++;_this.caja.find(".lineaEntidad").length+1;_this.caja.find("#"+id).after('<div id="lineaEntidad'+nId+'" class="lineaEntidad"><select id="sEntidad'+nId+'" class="entidad">'+option+'</select><img src="img/btQuitar.png" class="iconoPeque btQuitar" alt="Quitar" id="btQuitar'+nId+'"/></div>'),_this.caja.find("#btQuitar"+nId).after(_this.caja.find("#btMas")),_this.caja.find("#btQuitar"+nId).hover(function(e){$(this).attr("src","img/btQuitarSel.png")},function(e){$(this).attr("src","img/btQuitar.png")}).click(function(e){{var id=$(this).attr("id");id.substr("btQuitar".length)}_this.caja.find(".lineaEntidad").length<=2&&_this.caja.find("#sEntidad1").after($("#btMas")),$(_this.caja.find(".btQuitar")[_this.caja.find(".btQuitar").length-1]).attr("id")==$(this).attr("id")&&$(_this.caja.find(".btQuitar")[_this.caja.find(".btQuitar").length-2]).after($("#btMas")),$(this).parent().remove()}),_this.caja.find(".capaListaEntidades").scrollTop(1e4)})}return _inherits(DialogoNuevaISA,_Dialogo2),_createClass(DialogoNuevaISA,[{key:"comprobarErrores",value:function(){var codigo=0;return $("#sFuerte").val()||(codigo=ERROR.SuperFalta),$("#sEntidad1").val()||(codigo+=ERROR.SuperFalta),codigo}},{key:"realizarAccion",value:function(){var fuerte=$("#sFuerte").val(),eFuerte=ERMaker.buscarEntidad(fuerte),subs=[],nombre="";$(".entidad").each(function(i){nombre=$(this).val(),nombre&&subs.push(ERMaker.buscarEntidad(nombre))});var exclusiva=$("#cExclusiva").is(":checked"),total=$("#cTotal").is(":checked");ERMaker.objetoActual=new RelacionISA(eFuerte,subs,0,0,ERMaker.diagrama,exclusiva,total),ERMaker.estadoAplicacion=ESTADO_APLICACION.Anadiendo}}]),DialogoNuevaISA}(Dialogo),DialogoEditarISA=function(_Dialogo3){function DialogoEditarISA(isa){_classCallCheck(this,DialogoEditarISA),_get(Object.getPrototypeOf(DialogoEditarISA.prototype),"constructor",this).call(this,"Editar Relación ISA"),this._isa=isa;var total=isa.esTotal?" checked ":"",exclusiva=isa.esExclusiva?" checked ":"";this.caja.append('<div class="capaNombre"><p><input type="checkbox" id="cTotal" '+total+'><label for="cTotal">Total</label><br><input type="checkbox" id="cExclusiva" '+exclusiva+'><label for="cExclusiva">Exclusiva</label><br>')}return _inherits(DialogoEditarISA,_Dialogo3),_createClass(DialogoEditarISA,[{key:"realizarAccion",value:function(){$("#cTotal").is(":checked")&&0==this._isa.esTotal?this._isa.esTotal=!0:$("#cTotal").is(":checked")||1!=this._isa.esTotal||(this._isa.esTotal=!1),$("#cExclusiva").is(":checked")&&0==this._isa.esExclusiva?this._isa.esExclusiva=!0:$("#cExlusiva").is(":checked")||1!=this._isa.esExclusiva||(this._isa.esExclusiva=!1)}}]),DialogoEditarISA}(Dialogo),DialogoCargarArchivo=function(_Dialogo4){function DialogoCargarArchivo(titulo,texto){_classCallCheck(this,DialogoCargarArchivo),_get(Object.getPrototypeOf(DialogoCargarArchivo.prototype),"constructor",this).call(this,titulo,texto),$(".tituloDialogo").after('<div class="capaNombre"><p><label for="aNombre">Nombre del archivo</label><br/><input type="file" id="aNombre" type=".json">')}return _inherits(DialogoCargarArchivo,_Dialogo4),_createClass(DialogoCargarArchivo,[{key:"comprobarErrores",value:function(){return!1}},{key:"realizarAccion",value:function(){var fileInput=document.getElementById("aNombre");ERMaker.cargarJSON(fileInput.files[0])}}]),DialogoCargarArchivo}(Dialogo),DialogoGuardarArchivo=function(_DialogoNuevoObjeto5){function DialogoGuardarArchivo(){_classCallCheck(this,DialogoGuardarArchivo),_get(Object.getPrototypeOf(DialogoGuardarArchivo.prototype),"constructor",this).call(this,"Guardar Archivo","Nombre del archivo",""),$(".capaNombre").append('<br><table class="margen"><tr><td style="width:33%"><label for="cSVG">Formato SVG</label><input type="checkbox" id="cSVG"/></td><td style="width:33%"><label for="cPNG">Formato PNG</label><input type="checkbox" id="cPNG"/></td><td style="width:33%"><label for="cJSON">Formato JSON</label><input type="checkbox" id="cJSON" checked/></td></tr></table>')}return _inherits(DialogoGuardarArchivo,_DialogoNuevoObjeto5),_createClass(DialogoGuardarArchivo,[{key:"comprobarErrores",value:function(){return!1}},{key:"realizarAccion",value:function(){var nombreArchivo=$("#tNombre").val(),svg=$("#cSVG").is(":checked"),png=$("#cPNG").is(":checked"),json=$("#cJSON").is(":checked");nombreArchivo&&(svg||png||json)&&(svg&&DiagramaER.guardarSVG("lienzo",nombreArchivo+".svg"),png&&DiagramaER.guardarPNG("lienzo",nombreArchivo+".png"),json&&ERMaker.guardarJSON(nombreArchivo+".json"))}}]),DialogoGuardarArchivo}(DialogoNuevoObjeto),DialogoNuevoAtributo=function(_DialogoNuevoObjeto6){function DialogoNuevoAtributo(){_classCallCheck(this,DialogoNuevoAtributo),_get(Object.getPrototypeOf(DialogoNuevoAtributo.prototype),"constructor",this).call(this,"Nuevo Atributo","Atributo","");var option="",_iteratorNormalCompletion31=!0,_didIteratorError31=!1,_iteratorError31=void 0;try{for(var _step31,_iterator31=ERMaker.obtenerEntidadesYRelaciones()[Symbol.iterator]();!(_iteratorNormalCompletion31=(_step31=_iterator31.next()).done);_iteratorNormalCompletion31=!0){var objeto=_step31.value;option+="<option value='"+objeto.nombre+"'>"+objeto.nombre+"</option>"}}catch(err){_didIteratorError31=!0,_iteratorError31=err}finally{try{!_iteratorNormalCompletion31&&_iterator31["return"]&&_iterator31["return"]()}finally{if(_didIteratorError31)throw _iteratorError31}}this.caja.append('<div class="capaFuerte"><p><label for="sObjeto">Elemento (Entidad o Relación)</label><br/><select id="sObjeto">'+option+'</select></p><br><p><input type="radio" id="rClave" name="rClave"><label for="rClave">Clave</label><input type="radio" id="rAlt" name="rClave"><label for="rAlt">Alternativa</label></p>')}return _inherits(DialogoNuevoAtributo,_DialogoNuevoObjeto6),_createClass(DialogoNuevoAtributo,[{key:"comprobarErrores",value:function(){var codigo=_get(Object.getPrototypeOf(DialogoNuevoAtributo.prototype),"comprobarErrores",this).call(this),atributosCorrectos=!0,nombre=$("#tNombre").val(),objeto=ERMaker.buscarObjetoPorNombre(nombre);for(var atributo in objeto.listaAtributos)if(atributo.nombre==nombre){atributosCorrectos=!1,codigo+=ERROR.AtributoRepetido;break}return codigo}},{key:"realizarAccion",value:function(){var nombre=$("#tNombre").val(),tipo=void 0,objeto=ERMaker.buscarObjetoPorNombre($("#sObjeto").val());console.log(objeto),tipo=$("#rClave").is(":checked")?TIPO_ATRIBUTO.Clave:$("#rAlt").is(":checked")?TIPO_ATRIBUTO.Alternativo:TIPO_ATRIBUTO.Normal;var bb=objeto.texto.obtenerBBox(),angulo=360*Math.random(),x=1.5*bb.width*Math.sin(Raphael.rad(angulo)),y=1.5*bb.width*Math.cos(Raphael.rad(angulo));ERMaker.objetoActual=new Atributo(nombre,x,y,ERMaker.diagrama,objeto,tipo),ERMaker.objetoActual.conjunto.set.transform(objeto.caja.forma.attr("transform")),ERMaker.estadoAplicacion=ESTADO_APLICACION.Anadiendo}}]),DialogoNuevoAtributo}(DialogoNuevoObjeto),DialogoEditarAtributo=function(_DialogoNuevoObjeto7){function DialogoEditarAtributo(atributo){_classCallCheck(this,DialogoEditarAtributo),_get(Object.getPrototypeOf(DialogoEditarAtributo.prototype),"constructor",this).call(this,"Editar Atributo","Nombre",atributo.nombre),this.atributo=atributo;var esNormal="",esClave="",esAlternativa="";atributo.tipoAtributo==TIPO_ATRIBUTO.Normal?esNormal="CHECKED":atributo.tipoAtributo==TIPO_ATRIBUTO.Clave?esClave="CHECKED":atributo.tipoAtributo==TIPO_ATRIBUTO.Alternativo&&(esAlternativa="CHECKED"),this.caja.append('<div class="capaFuerte"><p><input type="radio" id="rNormal" name="rClave"'+esNormal+'><label for="rNormal">Normal</label><input type="radio" id="rClave" name="rClave"'+esClave+'><label for="rClave">Clave</label><input type="radio" id="rAlt" name="rClave"'+esAlternativa+'><label for="rAlt">Alternativa</label></p>')}return _inherits(DialogoEditarAtributo,_DialogoNuevoObjeto7),_createClass(DialogoEditarAtributo,[{key:"realizarAccion",value:function(){this.atributo.nombre=$("#tNombre").val(),this.atributo.tipoAtributo=$("#rNormal").is(":checked")?TIPO_ATRIBUTO.Normal:$("#rClave").is(":checked")?TIPO_ATRIBUTO.Clave:TIPO_ATRIBUTO.Alternativo}}]),DialogoEditarAtributo}(DialogoNuevoObjeto),DialogoEditarCardinalidad=function(_Dialogo5){function DialogoEditarCardinalidad(cajaCardinalidad){_classCallCheck(this,DialogoEditarCardinalidad),_get(Object.getPrototypeOf(DialogoEditarCardinalidad.prototype),"constructor",this).call(this,"Editar Cardinalidad"),this._cajaCardinalidad=cajaCardinalidad;var min1="1"==cajaCardinalidad.minima?"selected":"",min0="0"==cajaCardinalidad.minima?"selected":"",max1="1"==cajaCardinalidad.maxima?"selected":"",maxN="n"==cajaCardinalidad.maxima?"selected":"";this.caja.append('<div class="capaNombre"><p><label for="sMin">Cardinalidad mínima</label><br><select id="sMin"><option value="1"'+min1+'>1</option><option value="0"'+min0+'>0</option></select><br><label for="sMax">Cardinalidad máxima</label><br><select id="sMax"><option value="n"'+maxN+'>n</option><option value="1"'+max1+">1</option></select><br>")}return _inherits(DialogoEditarCardinalidad,_Dialogo5),_createClass(DialogoEditarCardinalidad,[{key:"realizarAccion",value:function(){this._cajaCardinalidad.minima=$("#sMin").val(),this._cajaCardinalidad.maxima=$("#sMax").val()}}]),DialogoEditarCardinalidad}(Dialogo),DialogoAjustes=function(_Dialogo6){function DialogoAjustes(){_classCallCheck(this,DialogoAjustes),_get(Object.getPrototypeOf(DialogoAjustes.prototype),"constructor",this).call(this,"Ajustes"),this.caja.addClass("dialogoMedio"),this.caja.append('<div class="capaAjustes"><label for="tColorEntidad">Color Entidades</label><input type color=')}return _inherits(DialogoAjustes,_Dialogo6),_createClass(DialogoAjustes,[{key:"realizarAccion",value:function(){this._cajaCardinalidad.minima=$("#sMin").val(),this._cajaCardinalidad.maxima=$("#sMax").val()}}]),DialogoAjustes}(Dialogo);