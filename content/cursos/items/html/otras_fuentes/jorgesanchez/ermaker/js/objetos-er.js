"use strict";function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _get=function(_x25,_x26,_x27){for(var _again=!0;_again;){var object=_x25,property=_x26,receiver=_x27;desc=parent=getter=void 0,_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return void 0;_x25=parent,_x26=property,_x27=receiver,_again=!0}},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Ajustes=new AjustesGenerales,count_centros=0,TIPO_ER={Generico:1,Entidad:2,Debil:3,Relacion:4,ISA:5,Cardinalidad:6,Atributo:7},TIPO_ATRIBUTO={Clave:1,Alternativo:2,Opcional:3,Normal:4},Punto=function(){function Punto(x,y){_classCallCheck(this,Punto),this._x=x,this._y=y}return _createClass(Punto,[{key:"cambiar",value:function(x,y){this._x=x,this._y=y}},{key:"toString",value:function(){return"("+this._x+","+this._y+")"}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}}]),Punto}(),FormaER=function(){function FormaER(x,y,diagrama){_classCallCheck(this,FormaER),this._colorBorde=Ajustes.c_borde_objetoER,this._colorFondo=Ajustes.c_entidad,this._grosorBorde=Ajustes.w_principal,this._forma=diagrama.paper.circle(x,y,0),this._paper=diagrama.paper,this._x=x,this._y=y}return _createClass(FormaER,[{key:"colorBorde",get:function(){return this._colorBorde},set:function(color){this._colorBorde=color,this._forma.attr("stroke",color)}},{key:"colorFondo",get:function(){return this._colorFondo},set:function(color){this._colorFondo=color,this._forma.attr("fill",color)}},{key:"grosorBorde",get:function(){return this._grosorBorde},set:function(color){this._grosorBorde=color,this._forma.attr("stroke-width",color)}},{key:"forma",get:function(){return this._forma}},{key:"x",get:function(){return this._x},set:function(n){this._forma.attr("x",n),this._x=n}},{key:"y",get:function(){return this._y},set:function(n){this._forma.attr("y",n),this._y=n}},{key:"paper",get:function(){return this._paper()}}]),FormaER}(),Linea=function(_FormaER){function Linea(origen,destino,diagrama){var grosor=arguments.length<=3||void 0===arguments[3]?Ajustes.w_principal:arguments[3],color=arguments.length<=4||void 0===arguments[4]?Ajustes.c_linea_principal:arguments[4];_classCallCheck(this,Linea),_get(Object.getPrototypeOf(Linea.prototype),"constructor",this).call(this,origen.x,origen.y,diagrama),this._paper=diagrama.paper,this.origen=origen,this.destino=destino,origen instanceof Punto&&destino instanceof Punto&&(this._forma=this._paper.path("M"+this.origen.x+","+this.origen.y+" "+this.destino.x+", "+this.destino.y),this.colorBorde=color,this.grosorBorde=grosor,this._forma.toBack())}return _inherits(Linea,_FormaER),_createClass(Linea,[{key:"cambiarOrigen",value:function(x,y){null!=this._forma&&(this.origen.cambiar(x,y),this.repintar())}},{key:"cambiarDestino",value:function(x,y){null!=this._forma&&(this.destino.cambiar(x,y),this.repintar())}},{key:"cambiar",value:function(origen,destino){null!=this.forma&&(this.origen.cambiar(origen.x,origen.y),this.destino.cambiar(destino.x,destino.y),this.repintar())}},{key:"repintar",value:function(){null!=this.forma&&this.forma.attr("path",["M",this.origen.x,this.origen.y,this.destino.x,this.destino.y])}},{key:"toString",value:function(){return this.origen.toString()+"-"+this.destino.toString()}}]),Linea}(FormaER),TextoER=function(_FormaER2){function TextoER(texto,x,y,diagrama){var tam=arguments.length<=4||void 0===arguments[4]?Ajustes.tam_normal:arguments[4],color=arguments.length<=5||void 0===arguments[5]?Ajustes.c_letra_objetoER:arguments[5],grosor=arguments.length<=6||void 0===arguments[6]?Ajustes.grosor_normal:arguments[6];_classCallCheck(this,TextoER),_get(Object.getPrototypeOf(TextoER.prototype),"constructor",this).call(this,x,y,diagrama),this._texto=texto,this._x=x,this._y=y,this._forma=diagrama.paper.text(x,y,texto),this._forma.attr({"text-anchor":"center","font-weight":grosor,"font-size":tam,fill:color}),this._tam=tam,this._color=color,this._tam=tam}return _inherits(TextoER,_FormaER2),_createClass(TextoER,[{key:"obtenerBBox",value:function(){return this.forma.getBBox()}},{key:"texto",get:function(){return this._texto},set:function(txt){this._texto=txt,this._forma.attr("text",txt)}},{key:"forma",get:function(){return this._forma}},{key:"tam",get:function(){return this._tam},set:function(tam){this._tam=tam,this._forma.attr("font-size",tam)}},{key:"color",get:function(){return this._color},set:function(color){this._color=color,this._forma.attr("fill",color)}},{key:"grosor",get:function(){return this._grosor},set:function(grosor){this._grosor=grosor,this._forma.attr("font-weight",grosor)}}]),TextoER}(FormaER),CajaER=function(_FormaER3){function CajaER(x,y,width,height,diagrama){var colorFondo=arguments.length<=5||void 0===arguments[5]?Ajustes.c_entidad:arguments[5],colorBorde=arguments.length<=6||void 0===arguments[6]?Ajustes.c_borde_objetoER:arguments[6],grosorBorde=arguments.length<=7||void 0===arguments[7]?Ajustes.w_principal:arguments[7];_classCallCheck(this,CajaER),_get(Object.getPrototypeOf(CajaER.prototype),"constructor",this).call(this,x,y,diagrama),this._forma=diagrama.paper.rect(x,y,width,height),this.colorFondo=colorFondo,this.colorBorde=colorBorde,this.grosorBorde=grosorBorde}return _inherits(CajaER,_FormaER3),_createClass(CajaER,[{key:"forma",get:function(){return this._forma}}]),CajaER}(FormaER),ElipseER=function(_FormaER4){function ElipseER(x,y,rx,ry,diagrama){var colorFondo=arguments.length<=5||void 0===arguments[5]?Ajustes.c_atributo:arguments[5],colorBorde=arguments.length<=6||void 0===arguments[6]?Ajustes.c_borde_atributo:arguments[6],grosorBorde=arguments.length<=7||void 0===arguments[7]?Ajustes.w_atributo:arguments[7];_classCallCheck(this,ElipseER),_get(Object.getPrototypeOf(ElipseER.prototype),"constructor",this).call(this,x,y,diagrama),this._forma=diagrama.paper.ellipse(x,y,rx,ry),this.colorFondo=colorFondo,this.colorBorde=colorBorde,this.grosorBorde=grosorBorde}return _inherits(ElipseER,_FormaER4),_createClass(ElipseER,[{key:"forma",get:function(){return this._forma}}]),ElipseER}(FormaER),RomboER=function(_FormaER5){function RomboER(bbox,diagrama){var colorFondo=arguments.length<=2||void 0===arguments[2]?Ajustes.c_relacion:arguments[2],colorBorde=arguments.length<=3||void 0===arguments[3]?Ajustes.c_borde_objetoER:arguments[3],grosorBorde=arguments.length<=4||void 0===arguments[4]?Ajustes.w_principal:arguments[4];_classCallCheck(this,RomboER),_get(Object.getPrototypeOf(RomboER.prototype),"constructor",this).call(this,bbox.x,bbox.y,diagrama),this._forma=diagrama.paper.path(["M",bbox.x-bbox.width/3,bbox.y+bbox.height/2,bbox.x+bbox.width/2,bbox.y-bbox.height/1.2,bbox.x+4*bbox.width/3,bbox.y+bbox.height/2,bbox.x+bbox.width/2,bbox.y+bbox.height/1.2+bbox.height,"z"]),this.colorFondo=colorFondo,this.colorBorde=colorBorde,this.grosorBorde=grosorBorde}return _inherits(RomboER,_FormaER5),_createClass(RomboER,[{key:"cambiar",value:function(bbox){this._forma.attr({path:["M",bbox.x-bbox.width/3,bbox.y+bbox.height/2,bbox.x+bbox.width/2,bbox.y-bbox.height/1.2,bbox.x+4*bbox.width/3,bbox.y+bbox.height/2,bbox.x+bbox.width/2,bbox.y+bbox.height/1.2+bbox.height,"z"]})}},{key:"forma",get:function(){return this._forma}}]),RomboER}(FormaER),TrianguloER=function(_FormaER6){function TrianguloER(bbox,diagrama){var colorFondo=arguments.length<=2||void 0===arguments[2]?Ajustes.c_fondo_isa:arguments[2],colorBorde=arguments.length<=3||void 0===arguments[3]?Ajustes.c_borde_objetoER:arguments[3],grosorBorde=arguments.length<=4||void 0===arguments[4]?Ajustes.w_principal:arguments[4];_classCallCheck(this,TrianguloER),_get(Object.getPrototypeOf(TrianguloER.prototype),"constructor",this).call(this,bbox.x,bbox.y,diagrama),this._forma=diagrama.paper.path(["M",bbox.x-Ajustes.m_entidad,bbox.y-Ajustes.m_entidad,bbox.x+bbox.width+Ajustes.m_entidad,bbox.y-Ajustes.m_entidad,bbox.x+bbox.width/2,bbox.y+bbox.height+Ajustes.m_entidad,"z"]),this.colorFondo=colorFondo,this.colorBorde=colorBorde,this.grosorBorde=grosorBorde}return _inherits(TrianguloER,_FormaER6),_createClass(TrianguloER,[{key:"cambiar",value:function(bbox){this._forma=diagrama.paper.path(["M",bbox.x-Ajustes.m_entidad,bbox.y-Ajustes.m_entidad,bbox.x+bbox.width+Ajustes.m_entidad,bbox.y-Ajustes.m_entidad,bbox.x+bbox.width/2,bbox.y+bbox.height+Ajustes.m_entidad,"z"])}},{key:"forma",get:function(){return this._forma}}]),TrianguloER}(FormaER),IconoBorrar=function(){function IconoBorrar(x,y,diagrama,parent){var _this=this;_classCallCheck(this,IconoBorrar),this._parent=parent,this.x=x,this.y=y,this._forma=diagrama.paper.image("img/iconoBorrar.png",x,y,40,40),this._forma.click(function(e){ERMaker.borrar(_this._parent)}),this._forma.mouseover(function(e){_this._forma.attr("src","img/iconoBorrar2.png"),_this._forma.attr("opacity",1),_this._forma.toFront()}),this._forma.mouseout(function(e){_this._forma.attr("src","img/iconoBorrar.png"),_this._forma.attr("opacity",0),_this._forma.toBack()})}return _createClass(IconoBorrar,[{key:"forma",get:function(){return this._forma}}]),IconoBorrar}(),IconoEditar=function(){function IconoEditar(x,y,diagrama,parent){var _this2=this;_classCallCheck(this,IconoEditar),this._parent=parent,this.x=x,this.y=y,this._forma=diagrama.paper.image("img/edit.png",x,y,40,40),this._forma.click(function(e){_this2._parent.editar()}),this._forma.mouseover(function(e){_this2._forma.attr("src","img/edit2.png"),_this2._forma.attr("opacity",1),_this2._forma.toFront()}),this._forma.mouseout(function(e){_this2._forma.attr("src","img/edit.png"),_this2._forma.attr("opacity",0),_this2._forma.toBack()})}return _createClass(IconoEditar,[{key:"forma",get:function(){return this._forma}}]),IconoEditar}(),ConjuntoER=function(){function ConjuntoER(textoER,diagrama){var parent=arguments.length<=2||void 0===arguments[2]?null:arguments[2];_classCallCheck(this,ConjuntoER),this._set=diagrama.paper.set(),this._set.push(textoER.forma),this._textoER=textoER,textoER.forma.toFront(),this._x=textoER.x,this._y=textoER.y,this.parent=parent,this._diagrama=diagrama}return _createClass(ConjuntoER,[{key:"añadirContenedor",value:function(contenedor){var desplX,desplY,_this3=this;this._set.push(contenedor.forma),this._textoER.forma.toFront(),contenedor instanceof Linea?contenedor.forma.toFront():(this._set.drag(function(dx,dy,x,y){_this3.parent.movido=!0;var scrollTop=0,scrollLeft=0;jQuery&&(scrollTop=$(_this3._diagrama.capa).parent().scrollTop(),scrollLeft=$(_this3._diagrama.capa).parent().scrollLeft()),desplX=dx,desplY=dy,_this3._set.transform("t"+(x-_this3._x-Ajustes.w_barra_herramientas+scrollLeft)+","+(y-_this3._y-Ajustes.w_barra_superior+scrollTop));var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_this3.parent.listaAtributos[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var atributo=_step.value;atributo.conjunto._set.transform("t"+(x-atributo.conjunto._x+atributo.relX-Ajustes.w_barra_herramientas+scrollLeft)+","+(y-atributo.conjunto._y+atributo.relY-Ajustes.w_barra_superior+scrollTop)),atributo.redibujar()}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}_this3.parent&&_this3.parent.redibujar(),_this3.parent.iconoBorrar.forma.attr({opacity:0}),_this3.parent.iconoEditar.forma.attr({opacity:0})},function(x,y,e){contenedor.forma.animate({"stroke-opacity":0},500),_this3.parent._tipo!=TIPO_ER.ISA?_this3._textoER.forma.animate({opacity:.25},500):_this3.parent.esTotal||_this3.parent.circulo.animate({"stroke-opacity":0},500)},function(e){contenedor.forma.animate({"stroke-opacity":1},500),_this3.parent._tipo==TIPO_ER.Atributo&&(_this3.parent.relX+=desplX,_this3.parent.relY+=desplY),_this3.parent._tipo!=TIPO_ER.ISA?_this3._textoER.forma.animate({opacity:1},1e3):_this3.parent.esTotal||_this3.parent.circulo.animate({"stroke-opacity":1},500)}),this._set.click(function(e){ERMaker&&ERMaker.clickObjeto(_this3.parent)})),this._set.mouseover(function(e){document.body.style.cursor="move",_this3.parent.iconoBorrar.forma.toFront(),_this3.parent.iconoBorrar.forma.attr({opacity:1}),_this3.parent.iconoEditar.forma.toFront(),_this3.parent.iconoEditar.forma.attr({opacity:1})}),this._set.mouseout(function(e){document.body.style.cursor="auto",_this3.parent.iconoBorrar.forma.toBack(),_this3.parent.iconoBorrar.forma.attr({opacity:0}),_this3.parent.iconoEditar.forma.toBack(),_this3.parent.iconoEditar.forma.attr({opacity:0})})}},{key:"borrar",value:function(){this._set.remove()}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"set",get:function(){return this._set}}]),ConjuntoER}(),ObjetoER=function(){function ObjetoER(nombre,x,y,diagrama){_classCallCheck(this,ObjetoER),this._texto=new TextoER(nombre,x,y,diagrama,Ajustes.tam_normal,Ajustes.c_letra_objetoER,Ajustes.grosor_normal),this._tipo=TIPO_ER.Generico,this.movido=!1,this.x=x,this.y=y,this._diagrama=diagrama,this._nombre=nombre,this._conjunto=new ConjuntoER(this._texto,diagrama,this),diagrama.añadirObjeto(this),this._caja=null,this._esTotal=!0,this._listaAtributos=[],this._tamLetra=Ajustes.tam_normal,this._colorLetra=Ajustes.c_letra_objetoER,this._grosorLetra=Ajustes.grosor_nomal,this._colorFondo=Ajustes.c_entidad,this._colorBorde=Ajustes.c_borde_objetoER,this._grosorBorde=Ajustes.grosor_normal;var bb=this._texto.obtenerBBox();this._iconoBorrar=new IconoBorrar(bb.x-40,bb.y-40+bb.height,diagrama,this),this._iconoBorrar.forma.attr("opacity",0),this._iconoEditar=new IconoEditar(bb.x+bb.width,bb.y-40+bb.height,diagrama,this),this._iconoEditar.forma.attr("opacity",0)}return _createClass(ObjetoER,[{key:"mover",value:function(x,y){var r=arguments.length<=2||void 0===arguments[2]?0:arguments[2];180>r&&(r+=180),r>=180&&270>r&&(r-=180),r="r"+r,this._conjunto.set.attr({transform:"t"+x+","+y+r+"t0,-"+Ajustes.distancia_cardinalidad}),this.redibujar()}},{key:"obtenerCentro",value:function(){var bb=this.texto.obtenerBBox(),x=bb.x+bb.width/2,y=bb.y+bb.height/2;return new Punto(x,y)}},{key:"redibujar",value:function(){this.iconoBorrar.forma.transform(this._texto.forma.attr("transform")),this.iconoEditar.forma.transform(this._texto.forma.attr("transform"))}},{key:"recalcular",value:function(){}},{key:"borrarAtributos",value:function(){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=this._listaAtributos[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var atributo=_step2.value;atributo.linea.forma.remove(),atributo.conjunto.borrar(),atributo=null}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}this._listaAtributos=null}},{key:"borrar",value:function(){this.iconoBorrar.forma.remove(),this.iconoEditar.forma.remove(),this._conjunto.borrar()}},{key:"editar",value:function(){ERMaker.editar(this)}},{key:"nombre",get:function(){return this._nombre},set:function(nom){this._texto.forma.attr("text",nom),this._nombre=nom,this.recalcular()}},{key:"tipo",get:function(){return this._tipo}},{key:"conjunto",get:function(){return this._conjunto}},{key:"texto",get:function(){return this._texto}},{key:"caja",get:function(){return this._caja}},{key:"esTotal",get:function(){return this._esTotal}},{key:"circulo",get:function(){return this._circulo}},{key:"listaAtributos",get:function(){return this._listaAtributos},set:function(lista){this._listaAtributos=lista;var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=this._listaAtributos[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var atributo=_step3.value;atributo.propietario=this,atributo.conjunto.set.toFront(),atributo.texto.forma.toFront(),atributo.haySubrayado()&&atributo.subrayado.forma.toFront()}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}}},{key:"tamLetra",get:function(){return this._tamLetra},set:function(tam){this.texto.tam=tam,this._tamLetra=tam,recalcular()}},{key:"colorLetra",get:function(){return this._colorLetra},set:function(color){this.texto.color=color,this._colorLetra=color}},{key:"grosorLetra",get:function(){return this._grosorLetra},set:function(grosor){this.texto.grosor=grosor,this._grosorLetra=grosor}},{key:"grosorBorde",get:function(){return this._grosorBorde},set:function(grosor){this.caja.grosorBorde=grosor,this._grosorBorde=grosor}},{key:"colorBorde",get:function(){return this._colorBorde},set:function(color){this.caja.colorBorde=color,this._colorBorde=color}},{key:"colorFondo",get:function(){return this._colorFondo},set:function(color){this.caja.colorFondo=color,this._colorFondo=color}},{key:"iconoBorrar",get:function(){return this._iconoBorrar}},{key:"iconoEditar",get:function(){return this._iconoEditar}}]),ObjetoER}(),Entidad=function(_ObjetoER){function Entidad(nombre,x,y,diagrama){_classCallCheck(this,Entidad),_get(Object.getPrototypeOf(Entidad.prototype),"constructor",this).call(this,nombre,x,y,diagrama),this._tipo=TIPO_ER.Entidad;var bb=this._texto.obtenerBBox();this._caja=new CajaER(bb.x-Ajustes.m_entidad,bb.y-Ajustes.m_entidad,bb.width+2*Ajustes.m_entidad,bb.height+2*Ajustes.m_entidad,diagrama,Ajustes.c_entidad,Ajustes.c_borde_objetoER,Ajustes.w_principal),this._conjunto=_get(Object.getPrototypeOf(Entidad.prototype),"conjunto",this),this._conjunto.añadirContenedor(this._caja),this._lineasRelaciones=[],this._listaDebiles=[],this._listaSupers=[],this._listaSubs=[]}return _inherits(Entidad,_ObjetoER),_createClass(Entidad,[{key:"redibujar",value:function(){_get(Object.getPrototypeOf(Entidad.prototype),"redibujar",this).call(this);var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=this._listaDebiles[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var debil=_step4.value;debil.redibujar()}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4["return"]&&_iterator4["return"]()}finally{if(_didIteratorError4)throw _iteratorError4}}var _iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=this._lineasRelaciones[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var linea=_step5.value;linea.relacion.redibujar()}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5["return"]&&_iterator5["return"]()}finally{if(_didIteratorError5)throw _iteratorError5}}var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=this._listaSupers[Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var superE=_step6.value;superE.redibujar()}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{!_iteratorNormalCompletion6&&_iterator6["return"]&&_iterator6["return"]()}finally{if(_didIteratorError6)throw _iteratorError6}}var _iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;try{for(var _step7,_iterator7=this._listaSubs[Symbol.iterator]();!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){var sub=_step7.value;sub.redibujar()}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{!_iteratorNormalCompletion7&&_iterator7["return"]&&_iterator7["return"]()}finally{if(_didIteratorError7)throw _iteratorError7}}var _iteratorNormalCompletion8=!0,_didIteratorError8=!1,_iteratorError8=void 0;try{for(var _step8,_iterator8=this._listaAtributos[Symbol.iterator]();!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=!0){var atributo=_step8.value;atributo.redibujar()}}catch(err){_didIteratorError8=!0,_iteratorError8=err}finally{try{!_iteratorNormalCompletion8&&_iterator8["return"]&&_iterator8["return"]()}finally{if(_didIteratorError8)throw _iteratorError8}}}},{key:"recalcular",value:function(){var bb=this._texto.obtenerBBox(),ancho=bb.width+2*Ajustes.m_entidad,alto=bb.height+2*Ajustes.m_entidad;this.iconoBorrar.forma.attr({x:this.iconoBorrar.forma.attr("x")-(ancho-this._caja.forma.attr("width"))/2,y:this.iconoBorrar.forma.attr("y")-(alto-this._caja.forma.attr("height"))/2}),this.iconoEditar.forma.attr({x:this.iconoEditar.forma.attr("x")+(ancho-this._caja.forma.attr("width"))/2,y:this.iconoEditar.forma.attr("y")+(alto-this._caja.forma.attr("height"))/2}),this._caja.forma.attr({x:this._caja.forma.attr("x")-(ancho-this._caja.forma.attr("width"))/2,y:this._caja.forma.attr("y")-(alto-this._caja.forma.attr("height"))/2,width:ancho,height:alto}),this.redibujar()}},{key:"borrar",value:function(){this.borrarAtributos();var _iteratorNormalCompletion9=!0,_didIteratorError9=!1,_iteratorError9=void 0;try{for(var _step9,_iterator9=this._listaSupers[Symbol.iterator]();!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=!0){var isa=_step9.value;isa.borrar()}}catch(err){_didIteratorError9=!0,_iteratorError9=err}finally{try{!_iteratorNormalCompletion9&&_iterator9["return"]&&_iterator9["return"]()}finally{if(_didIteratorError9)throw _iteratorError9}}var _iteratorNormalCompletion10=!0,_didIteratorError10=!1,_iteratorError10=void 0;try{for(var _step10,_iterator10=this._lineasRelaciones[Symbol.iterator]();!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=!0){var linea=_step10.value;linea.relacion.lineasRelacion.quitar(linea),linea.cajaCardinalidad.borrar(),linea.forma.remove(),linea.relacion.lineasRelacion.length<=1&&(linea.relacion.borrar(),ERMaker.listaObjetos.quitar(linea.relacion))}}catch(err){_didIteratorError10=!0,_iteratorError10=err}finally{try{!_iteratorNormalCompletion10&&_iterator10["return"]&&_iterator10["return"]()}finally{if(_didIteratorError10)throw _iteratorError10}}var _iteratorNormalCompletion11=!0,_didIteratorError11=!1,_iteratorError11=void 0;try{for(var _step11,_iterator11=this._listaSubs[Symbol.iterator]();!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=!0){var isa=_step11.value;if(1==isa.subEntidades.length)isa.borrar(),ERMaker.listaObjetos.quitar(isa);else{var i=isa.subEntidades.buscar(this);isa.lineasSub[i].forma.remove(),isa.lineasSub.splice(i,1),isa.subEntidades.quitar(this),1==isa.subEntidades.length&&isa.esExclusiva&&(isa.esExclusiva=!1),isa.redibujar()}}}catch(err){_didIteratorError11=!0,_iteratorError11=err}finally{try{!_iteratorNormalCompletion11&&_iterator11["return"]&&_iterator11["return"]()}finally{if(_didIteratorError11)throw _iteratorError11}}var _iteratorNormalCompletion12=!0,_didIteratorError12=!1,_iteratorError12=void 0;try{for(var _step12,_iterator12=this._listaDebiles[Symbol.iterator]();!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=!0){var debil=_step12.value,e=new Entidad(debil.nombre,debil.x,debil.y,this._diagrama);e._conjunto.set.transform(debil._caja.forma.attr("transform")),e.iconoBorrar.forma.transform(debil._caja.forma.attr("transform")),e.iconoEditar.forma.transform(debil._caja.forma.attr("transform")),e.listaAtributos=debil.listaAtributos,e.listaDebiles=debil.listaDebiles,e.lineasRelaciones=debil.lineasRelaciones,e.listaSupers=debil.listaSupers,e._listaSubs=debil.listaSubs;var _iteratorNormalCompletion13=!0,_didIteratorError13=!1,_iteratorError13=void 0;try{for(var _step13,_iterator13=e.listaSubs[Symbol.iterator]();!(_iteratorNormalCompletion13=(_step13=_iterator13.next()).done);_iteratorNormalCompletion13=!0){var isa=_step13.value,i=isa.subEntidades.buscar(debil);isa.subEntidades[i]=e,isa.redibujar()}}catch(err){_didIteratorError13=!0,_iteratorError13=err}finally{try{!_iteratorNormalCompletion13&&_iterator13["return"]&&_iterator13["return"]()}finally{if(_didIteratorError13)throw _iteratorError13}}debil.conjunto.borrar(),debil.linea.forma.remove(),ERMaker.listaObjetos.quitar(debil),ERMaker.listaObjetos.push(e)}}catch(err){_didIteratorError12=!0,_iteratorError12=err}finally{try{!_iteratorNormalCompletion12&&_iterator12["return"]&&_iterator12["return"]()}finally{if(_didIteratorError12)throw _iteratorError12}}_get(Object.getPrototypeOf(Entidad.prototype),"borrar",this).call(this)}},{key:"caja",get:function(){return this._caja}},{key:"lineasRelaciones",get:function(){return this._lineasRelaciones},set:function(lineas){this._lineasRelaciones=lineas;var _iteratorNormalCompletion14=!0,_didIteratorError14=!1,_iteratorError14=void 0;try{for(var _step14,_iterator14=this._lineasRelaciones[Symbol.iterator]();!(_iteratorNormalCompletion14=(_step14=_iterator14.next()).done);_iteratorNormalCompletion14=!0){var linea=_step14.value;linea.entidad=this}}catch(err){_didIteratorError14=!0,_iteratorError14=err}finally{try{!_iteratorNormalCompletion14&&_iterator14["return"]&&_iterator14["return"]()}finally{if(_didIteratorError14)throw _iteratorError14}}}},{key:"listaSupers",get:function(){return this._listaSupers},set:function(lista){this._listaSupers=lista;var _iteratorNormalCompletion15=!0,_didIteratorError15=!1,_iteratorError15=void 0;try{for(var _step15,_iterator15=lista[Symbol.iterator]();!(_iteratorNormalCompletion15=(_step15=_iterator15.next()).done);_iteratorNormalCompletion15=!0){var isa=_step15.value;isa.superEntidad=this}}catch(err){_didIteratorError15=!0,_iteratorError15=err}finally{try{!_iteratorNormalCompletion15&&_iterator15["return"]&&_iterator15["return"]()}finally{if(_didIteratorError15)throw _iteratorError15}}}},{key:"listaSubs",get:function(){return this._listaSubs}},{key:"listaDebiles",get:function(){return this._listaDebiles},set:function(lista){this._listaDebiles=lista;var _iteratorNormalCompletion16=!0,_didIteratorError16=!1,_iteratorError16=void 0;try{for(var _step16,_iterator16=lista[Symbol.iterator]();!(_iteratorNormalCompletion16=(_step16=_iterator16.next()).done);_iteratorNormalCompletion16=!0){var debil=_step16.value;debil.fuerte=this}}catch(err){_didIteratorError16=!0,_iteratorError16=err}finally{try{!_iteratorNormalCompletion16&&_iterator16["return"]&&_iterator16["return"]()}finally{if(_didIteratorError16)throw _iteratorError16}}}},{key:"conjunto",get:function(){return this._conjunto}}]),Entidad}(ObjetoER),Debil=function(_Entidad){function Debil(nombre,x,y,diagrama,fuerte){_classCallCheck(this,Debil),_get(Object.getPrototypeOf(Debil.prototype),"constructor",this).call(this,nombre,x,y,diagrama),this._conjunto=_get(Object.getPrototypeOf(Debil.prototype),"conjunto",this),this._tipo=TIPO_ER.Debil,this._fuerte=fuerte,fuerte.listaDebiles.push(this);var bb=this._texto.obtenerBBox();this._cajaExterior=new CajaER(bb.x-2*Ajustes.m_entidad,bb.y-2*Ajustes.m_entidad,bb.width+4*Ajustes.m_entidad,bb.height+4*Ajustes.m_entidad,diagrama,Ajustes.c_debil,Ajustes.c_borde_objetoER,Ajustes.w_principal),this._conjunto.añadirContenedor(this._cajaExterior),_get(Object.getPrototypeOf(Debil.prototype),"caja",this).forma.toFront(),_get(Object.getPrototypeOf(Debil.prototype),"texto",this).forma.toFront(),this._linea=new Linea(this.obtenerCentro(),fuerte.obtenerCentro(),diagrama,Ajustes.w_principal),this._colorBordeExterior=Ajustes.c_borde_objetoER,this._colorFondoExterior=Ajustes.c_debil,this._grosorBordeExterior=Ajustes.w_principal}return _inherits(Debil,_Entidad),_createClass(Debil,[{key:"redibujar",value:function(){_get(Object.getPrototypeOf(Debil.prototype),"redibujar",this).call(this),this._linea.cambiar(this.obtenerCentro(),this._fuerte.obtenerCentro())}},{key:"recalcular",value:function(){_get(Object.getPrototypeOf(Debil.prototype),"recalcular",this).call(this);this._texto.obtenerBBox();this._cajaExterior.forma.attr({x:this._caja.forma.attr("x")-Ajustes.m_entidad,y:this._caja.forma.attr("y")-Ajustes.m_entidad,width:this._caja.forma.attr("width")+2*Ajustes.m_entidad,height:this._caja.forma.attr("height")+2*Ajustes.m_entidad}),this.redibujar()}},{key:"borrar",value:function(){_get(Object.getPrototypeOf(Debil.prototype),"borrar",this).call(this),this._fuerte.listaDebiles.quitar(this),this._linea.forma.remove()}},{key:"cajaExterior",get:function(){return this._cajaExterior}},{key:"linea",get:function(){return this._linea}},{key:"fuerte",get:function(){return this._fuerte},set:function(otra){this._fuerte=otra}},{key:"colorFondoExterior",get:function(){return this._colorFondoExterior},set:function(color){this.cajaExterior.colorFondo=color,this._colorFondoExterior=color}},{key:"colorBordeExterior",get:function(){return this._colorBordeExterior},set:function(color){this.cajaExterior.colorBorde=color,this._colorBordeExterior=color}},{key:"grosorBordeExterior",get:function(){return this._grosorBordeExterior},set:function(grosor){this.cajaExterior.grosorBorde=grosor,this._grosorBordeExterior=grosor}}]),Debil}(Entidad),CajaCardinalidad=function(_ObjetoER2){function CajaCardinalidad(minima,maxima,x,y,diagrama){_classCallCheck(this,CajaCardinalidad),_get(Object.getPrototypeOf(CajaCardinalidad.prototype),"constructor",this).call(this,"("+minima+","+maxima+")",x,y,diagrama),this._minima=minima,this._maxima=maxima,this._conjunto=_get(Object.getPrototypeOf(CajaCardinalidad.prototype),"conjunto",this),this._tipo=TIPO_ER.Cardinalidad,this._texto.forma.attr({"font-size":Ajustes.tam_cardinalidad,"font-weight":Ajustes.grosor_cardinalidad,fill:Ajustes.c_letra_cardinalidad});var bb=this._texto.forma.getBBox();this._caja=new CajaER(bb.x-Ajustes.m_cardinalidad,bb.y-Ajustes.m_cardinalidad,bb.width+2*Ajustes.m_cardinalidad,bb.height+2*Ajustes.m_cardinalidad,diagrama,Ajustes.c_fondo_cardinalidad,"none",0),this._conjunto.añadirContenedor(this._caja),this.iconoBorrar.forma.attr({width:0,height:0}),this.iconoEditar.forma.attr("x",this.iconoEditar.forma.attr("x")-20)}return _inherits(CajaCardinalidad,_ObjetoER2),_createClass(CajaCardinalidad,[{key:"recalcular",value:function(){var bb=this._texto.obtenerBBox();this._caja.forma.attr({x:bb.x-Ajustes.m_entidad,y:bb.y-Ajustes.m_entidad,width:bb.width+2*Ajustes.m_entidad,height:bb.height+2*Ajustes.m_entidad})}},{key:"borrar",value:function(){this.iconoEditar.forma.remove(),this._conjunto.borrar()}},{key:"minima",get:function(){return this._minima},set:function(min){this.nombre="("+min+","+this._maxima+")",this._texto.forma.attr("text",this.nombre),this._minima=min}},{key:"maxima",get:function(){return this._maxima},set:function(max){this.nombre="("+this._minima+","+max+")",this._texto.forma.attr("text",this.nombre),
this._maxima=max}}]),CajaCardinalidad}(ObjetoER),LineaRelacion=function(_Linea){function LineaRelacion(entidad,relacion,minima,maxima,diagrama){var grosor=arguments.length<=5||void 0===arguments[5]?Ajustes.w_principal:arguments[5],color=arguments.length<=6||void 0===arguments[6]?Ajustes.c_linea_principal:arguments[6];_classCallCheck(this,LineaRelacion),_get(Object.getPrototypeOf(LineaRelacion.prototype),"constructor",this).call(this,relacion.obtenerCentro(),entidad.obtenerCentro(),diagrama,grosor,color),this._forma=_get(Object.getPrototypeOf(LineaRelacion.prototype),"forma",this),this._cajaCardinalidad=new CajaCardinalidad(minima,maxima,0,0,diagrama),this._relacion=relacion,this._entidad=entidad,this._diagrama=diagrama,this.dibujarCaja()}return _inherits(LineaRelacion,_Linea),_createClass(LineaRelacion,[{key:"dibujarCaja",value:function(){var tamTotalLinea=this._forma.getTotalLength(),punto=this._forma.getPointAtLength(Ajustes.pos_cardinalidad*tamTotalLinea/100);this._cajaCardinalidad.mover(punto.x,punto.y,punto.alpha)}},{key:"redibujar",value:function(){this.cambiar(this._relacion.obtenerCentro(),this._entidad.obtenerCentro()),this.dibujarCaja()}},{key:"borrar",value:function(){this._entidad.lineasRelaciones.quitar(this),this._relacion.lineasRelacion.quitar(this),this._cajaCardinalidad.borrar(),this._forma.remove()}},{key:"entidad",get:function(){return this._entidad},set:function(otra){this._entidad=otra}},{key:"relacion",get:function(){return this._relacion}},{key:"cajaCardinalidad",get:function(){return this._cajaCardinalidad}}]),LineaRelacion}(Linea),Cardinalidad=function Cardinalidad(minima,maxima,entidad){_classCallCheck(this,Cardinalidad),this.minima=minima,this.maxima=maxima,this.entidad=entidad},Relacion=function(_ObjetoER3){function Relacion(nombre,x,y,diagrama,listaCardinalidades){_classCallCheck(this,Relacion),_get(Object.getPrototypeOf(Relacion.prototype),"constructor",this).call(this,nombre,x,y,diagrama),this._tipo=TIPO_ER.Relacion,this._lineasRelacion=[];var _iteratorNormalCompletion17=!0,_didIteratorError17=!1,_iteratorError17=void 0;try{for(var _step17,_iterator17=listaCardinalidades[Symbol.iterator]();!(_iteratorNormalCompletion17=(_step17=_iterator17.next()).done);_iteratorNormalCompletion17=!0){var cardinalidad=_step17.value,lr=new LineaRelacion(cardinalidad.entidad,this,cardinalidad.minima,cardinalidad.maxima,diagrama);this._lineasRelacion.push(lr),cardinalidad.entidad.lineasRelaciones.push(lr)}}catch(err){_didIteratorError17=!0,_iteratorError17=err}finally{try{!_iteratorNormalCompletion17&&_iterator17["return"]&&_iterator17["return"]()}finally{if(_didIteratorError17)throw _iteratorError17}}this._conjunto=_get(Object.getPrototypeOf(Relacion.prototype),"conjunto",this),this._caja=new RomboER(_get(Object.getPrototypeOf(Relacion.prototype),"texto",this).obtenerBBox(),diagrama,Ajustes.c_relacion,Ajustes.c_borde_objetoER,Ajustes.w_principal),this._conjunto.añadirContenedor(this._caja)}return _inherits(Relacion,_ObjetoER3),_createClass(Relacion,[{key:"recalcular",value:function(){var bb=this._texto.obtenerBBox(),transformX=this._texto.forma.attr("transform")[0][1],transformY=this._texto.forma.attr("transform")[0][2],ajuste=this.movido?0:bb.height/2,incremento=this._caja.forma.attr("path")[0][1];this._caja.forma.attr({path:["M",bb.x-bb.width/3-transformX,bb.y+bb.height/2-transformY+ajuste,bb.x+bb.width/2-transformX,bb.y-bb.height/1.2-transformY+ajuste,bb.x+4*bb.width/3-transformX,bb.y+bb.height/2-transformY+ajuste,bb.x+bb.width/2-transformX,bb.y+bb.height/1.2+bb.height-transformY+ajuste,"z"]}),incremento-=this._caja.forma.attr("path")[0][1],this.iconoBorrar.forma.attr({x:this.iconoBorrar.forma.attr("x")-incremento}),this.iconoEditar.forma.attr({x:this.iconoEditar.forma.attr("x")+incremento}),this.redibujar()}},{key:"redibujar",value:function(){_get(Object.getPrototypeOf(Relacion.prototype),"redibujar",this).call(this);var _iteratorNormalCompletion18=!0,_didIteratorError18=!1,_iteratorError18=void 0;try{for(var _step18,_iterator18=this._lineasRelacion[Symbol.iterator]();!(_iteratorNormalCompletion18=(_step18=_iterator18.next()).done);_iteratorNormalCompletion18=!0){var linea=_step18.value;linea.redibujar()}}catch(err){_didIteratorError18=!0,_iteratorError18=err}finally{try{!_iteratorNormalCompletion18&&_iterator18["return"]&&_iterator18["return"]()}finally{if(_didIteratorError18)throw _iteratorError18}}var _iteratorNormalCompletion19=!0,_didIteratorError19=!1,_iteratorError19=void 0;try{for(var _step19,_iterator19=this._listaAtributos[Symbol.iterator]();!(_iteratorNormalCompletion19=(_step19=_iterator19.next()).done);_iteratorNormalCompletion19=!0){var linea=_step19.value;linea.redibujar()}}catch(err){_didIteratorError19=!0,_iteratorError19=err}finally{try{!_iteratorNormalCompletion19&&_iterator19["return"]&&_iterator19["return"]()}finally{if(_didIteratorError19)throw _iteratorError19}}}},{key:"borrar",value:function(){var _iteratorNormalCompletion20=!0,_didIteratorError20=!1,_iteratorError20=void 0;try{for(var _step20,_iterator20=this._lineasRelacion[Symbol.iterator]();!(_iteratorNormalCompletion20=(_step20=_iterator20.next()).done);_iteratorNormalCompletion20=!0){var linea=_step20.value;linea.entidad.lineasRelaciones.quitar(linea),linea.cajaCardinalidad.borrar(),linea.forma.remove()}}catch(err){_didIteratorError20=!0,_iteratorError20=err}finally{try{!_iteratorNormalCompletion20&&_iterator20["return"]&&_iterator20["return"]()}finally{if(_didIteratorError20)throw _iteratorError20}}this._lineasRelacion=null,this.borrarAtributos(),_get(Object.getPrototypeOf(Relacion.prototype),"borrar",this).call(this)}},{key:"lineasRelacion",get:function(){return this._lineasRelacion}}]),Relacion}(ObjetoER),RelacionISA=function(_ObjetoER4){function RelacionISA(superE,subs,x,y,diagrama){var esExclusiva=arguments.length<=5||void 0===arguments[5]?!0:arguments[5],esTotal=arguments.length<=6||void 0===arguments[6]?!1:arguments[6];_classCallCheck(this,RelacionISA),_get(Object.getPrototypeOf(RelacionISA.prototype),"constructor",this).call(this,"ISA",x,y,diagrama),this._tipo=TIPO_ER.ISA,this._superEntidad=superE,this._subEntidades=subs,this._esExclusiva=esExclusiva,this._esTotal=esTotal,this._circulo=null,this._arco=null,this._lineaSuper=new Linea(this.obtenerCentro(),superE.obtenerCentro(),diagrama),superE.listaSupers.push(this),this._lineasSub=[];var _iteratorNormalCompletion21=!0,_didIteratorError21=!1,_iteratorError21=void 0;try{for(var _step21,_iterator21=subs[Symbol.iterator]();!(_iteratorNormalCompletion21=(_step21=_iterator21.next()).done);_iteratorNormalCompletion21=!0){var entidad=_step21.value;this._lineasSub.push(new Linea(this.obtenerCentro(),entidad.obtenerCentro(),diagrama)),entidad.listaSubs.push(this)}}catch(err){_didIteratorError21=!0,_iteratorError21=err}finally{try{!_iteratorNormalCompletion21&&_iterator21["return"]&&_iterator21["return"]()}finally{if(_didIteratorError21)throw _iteratorError21}}if(this._conjunto=_get(Object.getPrototypeOf(RelacionISA.prototype),"conjunto",this),this._caja=new TrianguloER(this.texto.obtenerBBox(),diagrama),this._conjunto.añadirContenedor(this._caja),this.texto.forma.attr("opacity",0),this._arco=diagrama.paper.path(),this._arco.attr({"stroke-width":Ajustes.w_principal}),this._esTotal)this._circulo=null;else{var puntoParcial=this._lineaSuper.forma.getPointAtLength(1.3*Ajustes.tam_normal);this._circulo=diagrama.paper.circle(puntoParcial.x,puntoParcial.y,Ajustes.tam_normal/3),this._circulo.attr({"stroke-width":Ajustes.w_principal,fill:Ajustes.c_fondo_isa})}this.redibujar()}return _inherits(RelacionISA,_ObjetoER4),_createClass(RelacionISA,[{key:"lineaMasCorta",value:function(){for(var masCorto=this._lineasSub[0].forma.getTotalLength(),aux=masCorto,i=1;i<this._lineasSub.length;i++)aux=this._lineasSub[i].forma.getTotalLength(),masCorto>aux&&(masCorto=aux);return masCorto}},{key:"menorAngulo",value:function(){for(var aux,centroISA=this.obtenerCentro(),centroSub=this._subEntidades[0].obtenerCentro(),menor=Raphael.angle(centroISA.x,centroISA.y,centroSub.x,centroSub.y),linea=this._lineasSub[0],i=1;i<this._subEntidades.length;i++)centroSub=this._subEntidades[i].obtenerCentro(),aux=Raphael.angle(centroISA.x,centroISA.y,centroSub.x,centroSub.y),menor>aux&&(menor=aux,linea=this._lineasSub[i]);return linea}},{key:"mayorAngulo",value:function(){for(var aux,centroISA=this.obtenerCentro(),centroSub=this._subEntidades[0].obtenerCentro(),mayor=Raphael.angle(centroISA.x,centroISA.y,centroSub.x,centroSub.y),linea=this._lineasSub[0],i=1;i<this._subEntidades.length;i++)centroSub=this._subEntidades[i].obtenerCentro(),aux=Raphael.angle(centroISA.x,centroISA.y,centroSub.x,centroSub.y),aux>mayor&&(mayor=aux,linea=this._lineasSub[i]);return linea}},{key:"redibujar",value:function(){_get(Object.getPrototypeOf(RelacionISA.prototype),"redibujar",this).call(this);var centroSuper=this._superEntidad.obtenerCentro(),centroISA=this.obtenerCentro(),angulo=Raphael.angle(centroISA.x,centroISA.y,centroSuper.x,centroSuper.y),trans=this._caja.forma.attr("transform")+"";-1!=trans.indexOf("R")&&(trans=trans.substr(0,trans.indexOf("R"))),angulo+=270,this._caja.forma.transform(trans+"R"+angulo),this._lineaSuper.cambiar(centroISA,centroSuper);for(var i=0;i<this._lineasSub.length;i++)this._lineasSub[i].cambiar(centroISA,this._subEntidades[i].obtenerCentro());if(this._esExclusiva&&this._subEntidades.length>1){{var anchoCorto=this.lineaMasCorta()/2,lineaMenor=this.menorAngulo(),lineaMayor=this.mayorAngulo(),puntoInicio=lineaMenor.forma.getPointAtLength(anchoCorto),puntoFin=lineaMayor.forma.getPointAtLength(anchoCorto),centro=this.obtenerCentro();Raphael.angle(centro.x,centro.y,puntoInicio.x,puntoInicio.y),Raphael.angle(centro.x,centro.y,puntoFin.x,puntoFin.y)}this._arco.attr({path:["M",puntoInicio.x,puntoInicio.y,"A",centro.x,centro.y,0,0,1,puntoFin.x,puntoFin.y],opacity:.5})}if(0==this._esTotal){var puntoParcial=this._lineaSuper.forma.getPointAtLength(1.3*Ajustes.tam_normal);this._circulo.attr({cx:puntoParcial.x,cy:puntoParcial.y})}}},{key:"borrar",value:function(){this._superEntidad.listaSupers.quitar(this);var _iteratorNormalCompletion22=!0,_didIteratorError22=!1,_iteratorError22=void 0;try{for(var _step22,_iterator22=this._subEntidades[Symbol.iterator]();!(_iteratorNormalCompletion22=(_step22=_iterator22.next()).done);_iteratorNormalCompletion22=!0){var sub=_step22.value;sub.listaSubs.quitar(this)}}catch(err){_didIteratorError22=!0,_iteratorError22=err}finally{try{!_iteratorNormalCompletion22&&_iterator22["return"]&&_iterator22["return"]()}finally{if(_didIteratorError22)throw _iteratorError22}}_get(Object.getPrototypeOf(RelacionISA.prototype),"borrar",this).call(this),this._circulo&&this._circulo.remove(),this._arco&&this._arco.remove(),this._lineaSuper.forma.remove();var _iteratorNormalCompletion23=!0,_didIteratorError23=!1,_iteratorError23=void 0;try{for(var _step23,_iterator23=this._lineasSub[Symbol.iterator]();!(_iteratorNormalCompletion23=(_step23=_iterator23.next()).done);_iteratorNormalCompletion23=!0){var linea=_step23.value;linea.forma.remove()}}catch(err){_didIteratorError23=!0,_iteratorError23=err}finally{try{!_iteratorNormalCompletion23&&_iterator23["return"]&&_iterator23["return"]()}finally{if(_didIteratorError23)throw _iteratorError23}}}},{key:"esTotal",get:function(){return this._esTotal},set:function(si){if(this._esTotal=si,si)this._circulo.remove(),this._circulo=null;else{var puntoParcial=this._lineaSuper.forma.getPointAtLength(1.3*Ajustes.tam_normal);this._circulo=this._diagrama.paper.circle(puntoParcial.x,puntoParcial.y,Ajustes.tam_normal/3),this._circulo.attr({"stroke-width":Ajustes.w_principal,fill:Ajustes.c_fondo_isa})}this.redibujar()}},{key:"esExclusiva",get:function(){return this._esExclusiva},set:function(si){this._esExclusiva=si,0==si?(this._arco.remove(),this._arco=null):(this._arco=this._diagrama.paper.path(),this._arco.attr({"stroke-width":Ajustes.w_principal})),this.redibujar()}},{key:"superEntidad",get:function(){return this._superEntidad},set:function(otra){this._superEntidad=otra}},{key:"subEntidades",get:function(){return this._subEntidades},set:function(lista){this._subEntidades=lista}},{key:"lineasSub",get:function(){return this._lineasSub}},{key:"lineaSuper",get:function(){return this._lineaSuper}},{key:"circulo",get:function(){return this._circulo}},{key:"arco",get:function(){return this._arco}}]),RelacionISA}(ObjetoER),Atributo=function(_ObjetoER5){function Atributo(nombre,x,y,diagrama,propietario){var tipoAtributo=arguments.length<=5||void 0===arguments[5]?TIPO_ATRIBUTO.Normal:arguments[5];_classCallCheck(this,Atributo),_get(Object.getPrototypeOf(Atributo.prototype),"constructor",this).call(this,nombre,x,y,diagrama),this._tipo=TIPO_ER.Atributo,this._texto.forma.attr({"font-size":Ajustes.tam_atributo,fill:Ajustes.c_letra_atributo,"font-weight":Ajustes.grosor_atributo});var bb=this._texto.obtenerBBox();this._tipoAtributo=tipoAtributo,tipoAtributo==TIPO_ATRIBUTO.Clave||tipoAtributo==TIPO_ATRIBUTO.Alternativo?(this._subrayado=new Linea(new Punto(bb.x,bb.y+bb.height),new Punto(bb.x+bb.width,bb.y+bb.height),diagrama,Ajustes.w_atributo,Ajustes.c_linea_fina),this._subrayado.forma.attr("stroke-width",2),tipoAtributo==TIPO_ATRIBUTO.Alternativo&&this._subrayado.forma.attr("stroke-dasharray",".")):this._subrayado=null,this._texto.forma.undrag(),this._caja=new ElipseER(bb.x+bb.width/2+Ajustes.m_atributo/2,bb.y+bb.height/2+Ajustes.m_atributo/2,bb.width,bb.height,diagrama,Ajustes.c_atributo,Ajustes.c_borde_atributo,Ajustes.w_atributo),this._conjunto=_get(Object.getPrototypeOf(Atributo.prototype),"conjunto",this),this._conjunto.añadirContenedor(this._caja),this._conjunto=_get(Object.getPrototypeOf(Atributo.prototype),"conjunto",this),this._subrayado&&this._conjunto.añadirContenedor(this._subrayado),this._propietario=propietario,propietario.listaAtributos.push(this),this.relX=this.x-propietario.x,this.relY=this.y-propietario.y,this._linea=new Linea(this.obtenerCentro(),propietario.obtenerCentro(),diagrama,Ajustes.w_atributo),this.iconoBorrar.forma.attr("x",this.iconoBorrar.forma.attr("x")+20),this.iconoEditar.forma.attr("x",this.iconoEditar.forma.attr("x")-20),this._ñapa=2}return _inherits(Atributo,_ObjetoER5),_createClass(Atributo,[{key:"haySubrayado",value:function(){return 1==this._subrayado}},{key:"recalcular",value:function(){var bb=this._texto.obtenerBBox();if(this.iconoBorrar.forma.attr({x:this.iconoBorrar.forma.attr("x")-(bb.width-this._caja.forma.attr("rx"))/2,y:this.iconoBorrar.forma.attr("y")-(bb.height-this._caja.forma.attr("ry"))/2}),this.iconoEditar.forma.attr({x:this.iconoEditar.forma.attr("x")+(bb.width-this._caja.forma.attr("rx"))/2,y:this.iconoEditar.forma.attr("y")+(bb.height-this._caja.forma.attr("ry"))/2}),this._subrayado){var transformX=this._texto.forma.attr("transform")[0][1],transformY=this._texto.forma.attr("transform")[0][2];this._subrayado.cambiar(new Punto(bb.x-transformX,bb.y+bb.height*this._ñapa-transformY),new Punto(bb.x+bb.width-transformX,bb.y+bb.height*this._ñapa-transformY))}this._caja.forma.attr({rx:bb.width,ry:bb.height})}},{key:"redibujar",value:function(){_get(Object.getPrototypeOf(Atributo.prototype),"redibujar",this).call(this),this._linea.cambiar(this.obtenerCentro(),this._propietario.obtenerCentro())}},{key:"borrar",value:function(){this._propietario.listaAtributos.quitar(this),_get(Object.getPrototypeOf(Atributo.prototype),"borrar",this).call(this),this._linea.forma.remove()}},{key:"propietario",get:function(){return this._propietario},set:function(otro){this._propietario=otro}},{key:"caja",get:function(){return this._caja}},{key:"tipoAtributo",get:function(){return this._tipoAtributo},set:function(tipo){if(tipo!=this._tipoAtributo){if(this._tipoAtributo==TIPO_ATRIBUTO.Normal){var bb=this._texto.obtenerBBox(),transformX=this._texto.forma.attr("transform")[0][1],transformY=this._texto.forma.attr("transform")[0][2];this._subrayado=new Linea(new Punto(bb.x-transformX,bb.y+bb.height*this._ñapa-transformY),new Punto(bb.x+bb.width-transformX,bb.y+bb.height*this._ñapa-transformY),this._diagrama,Ajustes.w_atributo,Ajustes.c_linea_fina),this._subrayado.forma.attr("stroke-width",2),tipo==TIPO_ATRIBUTO.Alternativo&&this._subrayado.forma.attr("stroke-dasharray","."),this._subrayado.forma.transform(this._texto.forma.attr("transform")),this._conjunto.añadirContenedor(this._subrayado)}else tipo==TIPO_ATRIBUTO.Clave?this._subrayado.forma.attr("stroke-dasharray",""):tipo==TIPO_ATRIBUTO.Alternativo?this._subrayado.forma.attr("stroke-dasharray","."):tipo==TIPO_ATRIBUTO.Normal&&(this._subrayado.forma.remove(),this._subrayado=null);this._tipoAtributo=tipo,this.recalcular(),2==this._ñapa&&(this._ñapa=1)}}},{key:"linea",get:function(){return this._linea}},{key:"subrayado",get:function(){return this._subrayado}}]),Atributo}(ObjetoER),DiagramaER=function(){function DiagramaER(idCapa,ancho,alto){_classCallCheck(this,DiagramaER),this._paper=new Raphael(idCapa,ancho,alto),this._listaObjetos=[],this._capa=document.getElementById(idCapa)}return _createClass(DiagramaER,[{key:"añadirObjeto",value:function(o){this._listaObjetos.push(o)}},{key:"paper",get:function(){return this._paper}},{key:"capa",get:function(){return this._capa}},{key:"listaObjetos",get:function(){return this._listaObjetos}}],[{key:"guardarJSON",value:function(){var entidades=[],debiles=[],relaciones=[],isas=[],x="Hola",a=document.createElement("a");a.download="prueba.txt",a.type="tex/plain",a.href=(window.URL||webkitURL).createObjectURL(x),a.click();var _iteratorNormalCompletion24=!0,_didIteratorError24=!1,_iteratorError24=void 0;try{for(var _step24,_iterator24=this._listaObjetos[Symbol.iterator]();!(_iteratorNormalCompletion24=(_step24=_iterator24.next()).done);_iteratorNormalCompletion24=!0){var objeto=_step24.value;objeto.tipo==TIPO_ER.Entidad?entidades.push(objeto):objeto.tipo==TIPO_ER.Debil?debiles.push(objeto):objeto.tipo==TIPO_ER.Relacion?relaciones.push(objeto):objeto.tipo==TIPO_ER.ISA&&isas.push(objeto)}}catch(err){_didIteratorError24=!0,_iteratorError24=err}finally{try{!_iteratorNormalCompletion24&&_iterator24["return"]&&_iterator24["return"]()}finally{if(_didIteratorError24)throw _iteratorError24}}}},{key:"guardarSVG",value:function(idRaphael,nombreArchivo,idA){var svg=$("#"+idRaphael).html(),a=document.createElement("a");a.download=nombreArchivo,a.type="image/svg+xml";var blob=new Blob([svg],{type:"image/svg+xml"});a.href=(window.URL||webkitURL).createObjectURL(blob),a.click()}},{key:"guardarPNG",value:function(divRaphael,nombreArchivo){var canvas=document.getElementById("canvas");canvg(canvas,$("#"+divRaphael).html());var img=canvas.toDataURL("image/png"),a=document.createElement("a");a.href=img,a.download=nombreArchivo,a.click()}}]),DiagramaER}();